"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[64422],{7189:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>r,default:()=>c,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var t=n(74848),i=n(28453);const a={sidebar_label:"ExpressJS Experiments",title:"Experimenting in NodeJS ExpressJS",keywords:["owner:brock"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},r=void 0,o={id:"guides/node-express-abtests",title:"Experimenting in NodeJS ExpressJS",description:"ExpressJS is a fast, minimalist framework for NodeJS.",source:"@site/docs/guides/node-express-abtests.mdx",sourceDirName:"guides",slug:"/guides/node-express-abtests",permalink:"/guides/node-express-abtests",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/guides/node-express-abtests.mdx",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{sidebar_label:"ExpressJS Experiments",title:"Experimenting in NodeJS ExpressJS",keywords:["owner:brock"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"api",previous:{title:"ExpressJS Feature Flags",permalink:"/guides/node-express-feature-flags"},next:{title:"Flask Feature Flags",permalink:"/guides/python-flask-feature-flags"}},d={},l=[{value:"Creating Your First Experiment with Statsig in NodeJS ExpressJS",id:"creating-your-first-experiment-with-statsig-in-nodejs-expressjs",level:2},{value:"Project Setup for Experimentation in NodeJS ExpressJS",id:"project-setup-for-experimentation-in-nodejs-expressjs",level:2},{value:"Initializing the Statsig SDK",id:"initializing-the-statsig-sdk",level:2},{value:"Managing Identity",id:"managing-identity",level:2},{value:"Assign user to experiment",id:"assign-user-to-experiment",level:2},{value:"Using assignments in the HTML page",id:"using-assignments-in-the-html-page",level:2}];function p(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"ExpressJS is a fast, minimalist framework for NodeJS."}),"\n",(0,t.jsx)(s.p,{children:"ExpressJS stands out as a swift and minimalist framework within the NodeJS ecosystem, offering an optimal solution for developers aiming to implement experiments in their web applications. This guide dives into how you can seamlessly integrate the NodeJS Server SDK into an ExpressJS application, enabling you to dynamically assign users to experiments and manage test groups effectively."}),"\n",(0,t.jsxs)(s.admonition,{type:"tip",children:[(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.a,{href:"https://github.com/statsig-io/samples/tree/node-express/node-express#node-express-statsig-demo-app",children:"ExpressJS + Statsig Sample App source code here"}),"."]}),(0,t.jsx)(s.p,{children:"The readme within details the steps on installing the app and its dependencies, setting the necessary environment variables, and running the app. Those concepts won't be covered in this guide because they are standard NodeJS practices."})]}),"\n",(0,t.jsx)(s.h2,{id:"creating-your-first-experiment-with-statsig-in-nodejs-expressjs",children:"Creating Your First Experiment with Statsig in NodeJS ExpressJS"}),"\n",(0,t.jsxs)(s.p,{children:["The below command can be run to automatically create the simple ",(0,t.jsx)(s.code,{children:"express_app_test"})," experiment in Statsig that gets used throughout this integration guide and demo app.\nThe experiment randomizes based on ",(0,t.jsx)(s.code,{children:"userID"}),", has a 50/50 test group split, and implements a single parameter.\nMake sure to replace the authorization key in the header with your key generated in Statsig project settings as documented ",(0,t.jsx)(s.a,{href:"/console-api/introduction",children:"here"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'curl --request POST \'https://statsigapi.net/console/v1/experiments\' \\\n--header \'STATSIG-API-KEY: console-REPLACE_WITH_YOURS\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{"name":"express_app_test","idType":"userID","status":"active","hypothesis":"Running Statsig in express works nicely!","primaryMetrics":[{"name":"dau","type":"user"}],"primaryMetricTags":[],"secondaryMetrics":[{"name":"dau","type":"user"}],"secondaryMetricTags":[],"groups":[{"name":"Control","size":50,"parameterValues":{"variant":"control"}},{"name":"Test","size":50,"parameterValues":{"variant":"test"}}],"allocation":100,"duration":14}\'\n\n# Note that the above request creates an Unstarted experiment\n# Either start the experiment via Console or via this command:\ncurl --request PUT \'https://statsigapi.net/console/v1/experiments/express_app_test/start\' \\\n--header \'STATSIG-API-KEY: console-REPLACE_WITH_YOURS\'\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Statsig experiment configuration interface",src:n(50672).A+"",width:"1904",height:"444"})}),"\n",(0,t.jsx)(s.h2,{id:"project-setup-for-experimentation-in-nodejs-expressjs",children:"Project Setup for Experimentation in NodeJS ExpressJS"}),"\n",(0,t.jsxs)(s.p,{children:["This example was built on the very simple ",(0,t.jsx)(s.a,{href:"https://expressjs.com/en/starter/hello-world.html",children:"Hello World"})," example app documented by ExpressJS.\nThe main server entrypoint is ",(0,t.jsx)(s.code,{children:"app.js"})," and the demo webpage source follows the handlebars standard, living in ",(0,t.jsx)(s.code,{children:"views/index.hbs"}),"."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"ExpressJS project folder structure",src:n(35385).A+"",width:"1646",height:"408"})}),"\n",(0,t.jsxs)(s.p,{children:["Aside from ",(0,t.jsx)(s.code,{children:"statsig-node"}),", this example app requires several node modules, including:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"cookie-parser"})," for managing cookies for user identity"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"uuidv4"})," for generating a random uuid"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"express"})," as the NodeJS web framework"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"express-handlebars"})," as the template engine"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"dotenv"})," for secret management"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"initializing-the-statsig-sdk",children:"Initializing the Statsig SDK"}),"\n",(0,t.jsx)(s.p,{children:"Every expressJS app has the call to boot the server and listen for requests. This is a convenient place to initialize the Statsig SDK.\nHere is an example of how that can be achieved:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"app.listen(port, async () => {\n  const runtimeEnv = process.env.STATSIG_ENV_TIER || 'production';\n  await statsig.initialize(process.env.STATSIG_SERVER_KEY, {\n    environment: { tier: runtimeEnv },\n  });\n  console.log(`Example app listening in ${runtimeEnv} on port ${port}`);\n});\n"})}),"\n",(0,t.jsx)(s.h2,{id:"managing-identity",children:"Managing Identity"}),"\n",(0,t.jsx)(s.p,{children:"Any Statsig SDK method call requires a userObject to be passed in. For known users that are logged in and an identity is accessible, this is trivial.\nIn the case where identity isn't available, it's ideal to either (a) read an existing cookie ID available to the app or (b) create and use a new uid for the purposes of anonymous assignment within the Statsig SDK.\nExpressJS offers a convenient middleware pattern that allows this business logic to be defined once, and it can be used globally in any route handler. Here is an example of what that looks like:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.em,{children:["Generating and setting an anonymous uid requires installing ",(0,t.jsx)(s.code,{children:"uuidv4"})," and ",(0,t.jsx)(s.code,{children:"cookie-parser"})," module"]})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"// earlier in the source, prior to app.listen call\napp.use(cookieParser());\n\n/**\n* global middleware to set a cookie if it doesn't exist\n* passes the uuid down to route handlers on req object\n*/\napp.use(async (req, res, next) => {\n  let statsigDeviceID;\n  if (req.cookies['statsig_uuid']) {\n    statsigDeviceID = req.cookies['statsig_uuid'];\n  }\n  else {\n    statsigDeviceID = uuidv4();\n    res.cookie('statsig_uuid', statsigDeviceID);\n  }\n  req.statsigDeviceID = statsigDeviceID;\n  next();\n});\n"})}),"\n",(0,t.jsx)(s.h2,{id:"assign-user-to-experiment",children:"Assign user to experiment"}),"\n",(0,t.jsxs)(s.p,{children:["In your route handler, you will have access to the global ",(0,t.jsx)(s.code,{children:"statsig"})," singleton. Whenever you need to assign a user to an experiment and access the Test Group parameters, you can simply call ",(0,t.jsx)(s.code,{children:"statsig.getExperiment"})," and pass in the user object. This will return an object that contains the experiment config, where you can access the assigned parameters using ",(0,t.jsx)(s.code,{children:'get("<param key>", <default value>)'}),". You can read more on this approach and the best practices ",(0,t.jsx)(s.a,{href:"/server/nodejsServerSDK#getting-an-layerexperiment",children:"here"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"app.get('/', async (req, res) => {\n  const user = {\n    // use the random uuid in cookie as the userID\n    // in practice, you'd use a known userID here\n    userID: req.statsigDeviceID,\n    country: 'US',\n    custom: {\n      employee: true\n    }\n  };\n  const testGroup = statsig.getExperimentSync(user, 'express_app_test').get('variant', 'control');\n  res.render('index.hbs', { \n    testGroup,\n  });\n});\n"})}),"\n",(0,t.jsx)(s.h2,{id:"using-assignments-in-the-html-page",children:"Using assignments in the HTML page"}),"\n",(0,t.jsxs)(s.p,{children:["The template will be rendered and with access to the ",(0,t.jsx)(s.code,{children:"testGroup"})," (string) variable, which gets used to display ",(0,t.jsx)(s.code,{children:'You are in "Group"'}),". The rendered template will be served to the user as an HTML document."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-hbs",children:'<body class="has-bg">\n<div id="main">\n    <h1>Statsig sample Express app</h1>\n    <h3>You are in "{{testGroup}}"</h3>\n</div>\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"ExpressJS sample app webpage showing experiment assignment",src:n(85544).A+"",width:"1382",height:"846"})})]})}function c(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},50672:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/express-abtest-9ace4f9fc2d24dd72ed37a254080d6d4.png"},35385:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/express-folder-structure-725819caa7b52fa954dd13473fdd28eb.png"},85544:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/express-page-19016d13e042434db65a00b0aec07f75.png"},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>o});var t=n(96540);const i={},a=t.createContext(i);function r(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);