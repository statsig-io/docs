"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[67141],{63399:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var a=n(74848),r=n(28453),s=n(11470),i=n(19365);const o={title:"Local Eval Adapter",sidebar_label:"Local Eval Adapter",slug:"/client/concepts/local-eval-adapter",keywords:["owner:brock"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},l=void 0,c={id:"client/concepts/local-eval-adapter",title:"Local Eval Adapter",description:"Local Eval Adapter",source:"@site/docs/client/concepts/local-eval-adapter.mdx",sourceDirName:"client/concepts",slug:"/client/concepts/local-eval-adapter",permalink:"/client/concepts/local-eval-adapter",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/client/concepts/local-eval-adapter.mdx",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{title:"Local Eval Adapter",sidebar_label:"Local Eval Adapter",slug:"/client/concepts/local-eval-adapter",keywords:["owner:brock"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"api",previous:{title:"Server Persistent Assignment",permalink:"/server/concepts/persistent_assignment"},next:{title:"Server Data Stores",permalink:"/server/concepts/data_store"}},u={},d=[{value:"Local Eval Adapter",id:"local-eval-adapter",level:2},{value:"Limitations",id:"limitations",level:2},{value:"Usage &amp; Functionality",id:"usage--functionality",level:2},{value:"Example Ruleset &quot;Config Spec&quot;",id:"example-ruleset-config-spec",level:3}];function p(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"local-eval-adapter",children:"Local Eval Adapter"}),"\n",(0,a.jsxs)(t.p,{children:["A common limitation of experimentation systems is the ",(0,a.jsx)(t.strong,{children:"dependence on an upfront network requests to fetch experiment configurations"}),". While concepts like ",(0,a.jsx)(t.a,{href:"/client/concepts/initialize#2-bootstrap-initialization",children:"Bootstrapping"})," and ",(0,a.jsx)(t.a,{href:"/client/concepts/initialize#4-synchronous-initialization",children:"Synchronous Initialization"})," can provide alternatives, both have caveats that are sometimes prohibitive: Bootstrapping still requires an upfront request (though it can be made synchronous with other requests), and Synchronous Initialization Strategies can result in out-of-date configs (by one session)."]}),"\n",(0,a.jsxs)(t.p,{children:["The Local Eval Adapter solves this by enabling you to ship your experiment configurations inline with your application, meaning you can run experiments before initialization completes. The adapter expects a ruleset explaining your experiments, similar to Statsig's Server SDKs - see the ",(0,a.jsx)(t.a,{href:"#example-ruleset-config-spec",children:"Example Ruleset below"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"limitations",children:"Limitations"}),"\n",(0,a.jsx)(t.p,{children:"Shipping with a ruleset presents security concerns, but given that the experiment set can be scoped to only an experiment or two occurring before any network requests, those concerns are often minimal. However, we expect users to take caution shipping a ruleset in their production code, vetting the contents are correct and safe."}),"\n",(0,a.jsx)(t.h2,{id:"usage--functionality",children:"Usage & Functionality"}),"\n",(0,a.jsxs)(t.p,{children:["The Local Eval Adapter, with proper attention to security, and maintenance of the ruleset in your application, ",(0,a.jsx)(t.strong,{children:"addresses the downsides of other experiment-at-launch strategies"}),"."]}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsx)(t.p,{children:"The local evaluation adapter is for Enterprise and Pro Tier companies only.  If you are trying to follow these instructions but do not meet that criteria, some of the setup steps may not work."})}),"\n",(0,a.jsx)(t.p,{children:"The Adapter manifests as a StatsigOptions object seeded with a ruleset payload:"}),"\n",(0,a.jsxs)(s.A,{children:[(0,a.jsxs)(i.A,{value:"ios",label:"iOS",children:[(0,a.jsx)("h3",{children:"iOS"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-swift",children:'Statsig.initialize(\n    sdkKey: "client-sdkkey",\n    user: user,\n    options: StatsigOptions(\n        overrideAdapter: OnDeviceEvalAdapter(stringPayload: onDeviceEvalAdapterRulesetPayload)\n    )\n) { err in\n    // Initialization completed. `err` is `nil` if it was successful\n}\n'})})]}),(0,a.jsxs)(i.A,{value:"android",label:"Android",children:[(0,a.jsx)("h3",{children:"Android"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-kotlin",children:'val adapter = OnDeviceEvalAdapter("...") // dcs payload as string\nval user = StatsigUser("a-user")\n\nStatsig.initializeAsync(application, "client-sdk", user, object : IStatsigCallback {\n  override fun onStatsigInitialize() {\n    println(adapter.getGate(Statsig.getFeatureGate("a_gate"), user)?.details?.reason) // [OnDevice] Bootstrap:Recognized\n    println(Statsig.getFeatureGate("a_gate").details.reason) // Network:Recognized\n  }\n})\n'})})]}),(0,a.jsxs)(i.A,{value:"js",label:"JavaScript",children:[(0,a.jsx)("h3",{children:"JavaScript"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"const adapter = new OnDeviceEvalAdapter();\nadapter.setData('...'); // dcs payload as string\n\nconst client = new StatsigClient(\n  'client-...',\n  { userID: 'a-user' },\n  {\n    overrideAdapter: adapter,\n  },\n);\n\n// purposely not awaiting this, will use local specs until network is resolved\nconst isReady = client.initializeAsync();\n\nconst localEvalGate = client.getFeatureGate('a_gate');\nconsole.log(localEvalGate.details.reason); // [OnDevice] Bootstrap:Recognized\n\nawait isReady;\n\nconst networkEvalGate = client.getFeatureGate('a_gate');\nconsole.log(networkEvalGate.details.reason); // Network:Recognized\n"})})]})]}),"\n",(0,a.jsx)(t.h3,{id:"example-ruleset-config-spec",children:'Example Ruleset "Config Spec"'}),"\n",(0,a.jsx)(t.p,{children:"The ruleset is a JSON object that contains the following fields:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-json",children:'{\n  "feature_gates": [],\n  "dynamic_configs": [],\n  "layer_configs": [],\n  "time": 1735718400000\n}\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Your ruleset can be retrieved by API, and we recommend using target apps to scope the ruleset to only the experiments and feature gates you need on startup. If you need help, reach out to us in your Slack Channel or our ",(0,a.jsx)(t.a,{href:"https://statsig.com/slack",children:"community Slack"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},19365:(e,t,n)=>{n.d(t,{A:()=>i});n(96540);var a=n(34164);const r={tabItem:"tabItem_Ymn6"};var s=n(74848);function i(e){let{children:t,hidden:n,className:i}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.tabItem,i),hidden:n,children:t})}},11470:(e,t,n)=>{n.d(t,{A:()=>j});var a=n(96540),r=n(34164),s=n(23104),i=n(56347),o=n(205),l=n(57485),c=n(31682),u=n(70679);function d(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}(n);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const r=(0,i.W6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(s),(0,a.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(r.location.search);t.set(s,e),r.replace({...r.location,search:t.toString()})}),[s,r])]}function v(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,s=p(e),[i,l]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:s}))),[c,d]=m({queryString:n,groupId:r}),[v,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,s]=(0,u.Dv)(n);return[r,(0,a.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:r}),f=(()=>{const e=c??v;return h({value:e,tabValues:s})?e:null})();(0,o.A)((()=>{f&&l(f)}),[f]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!h({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),g(e)}),[d,g,s]),tabValues:s}}var g=n(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=n(74848);function x(e){let{className:t,block:n,selectedValue:a,selectValue:i,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),u=e=>{const t=e.currentTarget,n=l.indexOf(t),r=o[n].value;r!==a&&(c(t),i(r))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},t),children:o.map((e=>{let{value:t,label:n,attributes:s}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:e=>l.push(e),onKeyDown:d,onClick:u,...s,className:(0,r.A)("tabs__item",f.tabItem,s?.className,{"tabs__item--active":a===t}),children:n??t},t)}))})}function y(e){let{lazy:t,children:n,selectedValue:s}=e;const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===s));return e?(0,a.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function w(e){const t=v(e);return(0,b.jsxs)("div",{className:(0,r.A)("tabs-container",f.tabList),children:[(0,b.jsx)(x,{...t,...e}),(0,b.jsx)(y,{...t,...e})]})}function j(e){const t=(0,g.A)();return(0,b.jsx)(w,{...e,children:d(e.children)},String(t))}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var a=n(96540);const r={},s=a.createContext(r);function i(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);