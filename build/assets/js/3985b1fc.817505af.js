"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[29572],{83045:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var t=s(74848),i=s(28453);const o={title:"Custom Proxy for Statsig API",slug:"/custom_proxy",keywords:["owner:eric"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},r=void 0,a={id:"infrastructure/api_proxy/custom_proxy",title:"Custom Proxy for Statsig API",description:"Overview",source:"@site/docs/infrastructure/api_proxy/custom_proxy.md",sourceDirName:"infrastructure/api_proxy",slug:"/custom_proxy",permalink:"/custom_proxy",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/infrastructure/api_proxy/custom_proxy.md",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{title:"Custom Proxy for Statsig API",slug:"/custom_proxy",keywords:["owner:eric"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"cloud",previous:{title:"Managed API Proxy",permalink:"/infrastructure/managed-proxy"},next:{title:"Forward Proxy",permalink:"/server/concepts/forward_proxy"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"Approaches",id:"approaches",level:2},{value:"AWS CloudFront",id:"aws-cloudfront",level:3},{value:"Prerequisites",id:"prerequisites",level:4},{value:"Setup",id:"setup",level:4},{value:"Cloudflare Worker",id:"cloudflare-worker",level:3},{value:"Prerequisites",id:"prerequisites-1",level:4},{value:"Setup",id:"setup-1",level:4},{value:"Using Your Proxy",id:"using-your-proxy",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Instead of sending API requests directly to Statsig, you can set up your own environment that proxies requests from your custom domain name to Statsig. This makes it less likely for tracking blockers to intercept your APIs, and allows you to capture more data."}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["If you just want Statsig to manage your proxy, you can use our ",(0,t.jsx)(n.a,{href:"/infrastructure/managed-proxy",children:"Managed API Proxy"})," instead."]})}),"\n",(0,t.jsx)(n.p,{children:"There are many ways to set up custom proxies. We are showing instructions for a few common service providers here."}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"Regardless of implementation, your proxy should just passthrough and not try to deserialize the payload. This will improve robustness by reducing risk of integration issues from Server SDK -> Proxy -> Client SDK, as well as, improve efficiency of the proxy. For example, client SDKs may change encoding to compress payloads, which would break if your proxy does not accept the new format (e.g. gzip)"})}),"\n",(0,t.jsx)(n.h2,{id:"approaches",children:"Approaches"}),"\n",(0,t.jsx)(n.h3,{id:"aws-cloudfront",children:"AWS CloudFront"}),"\n",(0,t.jsx)(n.h4,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Write access to your DNS settings."}),"\n",(0,t.jsx)(n.li,{children:"Write access on your AWS CloudFront and Lambda console."}),"\n",(0,t.jsx)(n.li,{children:"Access to a SSL certificate for your custom domain."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"setup",children:"Setup"}),"\n",(0,t.jsxs)(n.p,{children:["On your ",(0,t.jsx)(n.a,{href:"https://console.aws.amazon.com/cloudfront/",children:"AWS CloudFront console"}),","]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Click on Create distribution."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"In the Origin section,"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Set the Origin Domain to ",(0,t.jsx)(n.code,{children:"api.statsig.com"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Set the Protocol to ",(0,t.jsx)(n.code,{children:"HTTPS only"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://user-images.githubusercontent.com/7304774/178337858-834c6762-15b4-410d-91bb-68e04932523e.png",alt:"Origin section"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"In the Default cache behavior section,"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Set Viewer protocol policy to ",(0,t.jsx)(n.code,{children:"Redirect HTTP to HTTPS"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Set Allowed HTTP methods to ",(0,t.jsx)(n.code,{children:"GET, HEAD, OPTIONS, PUT, POST, PATCH, DELETE"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"In the Cache Key and origin requests subsection, allow all headers and parameters to be forwarded to the Origin, and allow CORS requests for the Origin."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://user-images.githubusercontent.com/7304774/178590547-acdedcb6-e15a-4086-a29f-0657242d9894.png",alt:"Default cache behavior section"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"In Function associations section,"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add a Lambda@Edge function to Origin request to rewrite the ",(0,t.jsx)(n.code,{children:"Host"})," header to ",(0,t.jsx)(n.code,{children:"api.statsig.com"}),". Please refer to ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/lambda-edge-how-it-works-tutorial.html",children:"the AWS tutorial on creating a Lambda@Edge function"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://user-images.githubusercontent.com/7304774/178591897-a93a046a-c76f-4fc6-ab0c-86452de99be7.png",alt:"Function associations section"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"You can use the following javascript code snippet in your Lambda@Edge function:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'export const handler = async (event, context, callback) => {\n  const request = event.Records[0].cf.request;\n  request.headers.host[0].value = "api.statsig.com";\n  return callback(null, request);\n};\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"In Settings,"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add an Alternate domain name (CNAME) to be your preferred domain name to use for the custom proxy, e.g. ",(0,t.jsx)(n.code,{children:"statsig.example.com"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Add a Custom SSL certificate. You will need to follow the ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html#alternate-domain-names-requirements",children:"AWS guide for Alternate domain name"})," to add a SSL certificate."]}),"\n",(0,t.jsx)(n.li,{children:"Click on Create distribution."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://user-images.githubusercontent.com/7304774/178337890-828e9f37-dd28-43a3-adc1-061052916045.png",alt:"Settings"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["You will get a Distribution domain name (e.g. ",(0,t.jsx)(n.code,{children:"d111111abcdef8.cloudfront.net"}),") once it is provisioned."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"In your DNS settings (depending on your DNS provider),"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Add a CNAME record in your custom DNS record:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Host name: ",(0,t.jsx)(n.code,{children:"statsig.example.com"})]}),"\n",(0,t.jsxs)(n.li,{children:["Type: ",(0,t.jsx)(n.code,{children:"CNAME"})]}),"\n",(0,t.jsxs)(n.li,{children:["Data: ",(0,t.jsx)(n.code,{children:"d111111abcdef8.cloudfront.net"})," (The Distribution domain name from AWS)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Your proxy should now be setup. See ",(0,t.jsx)(n.a,{href:"#using-your-proxy",children:"Using Your Proxy"})," for instructions on how to configure your Statsig SDK."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"cloudflare-worker",children:"Cloudflare Worker"}),"\n",(0,t.jsx)(n.h4,{id:"prerequisites-1",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.p,{children:["You will need a Cloudflare account. Visit ",(0,t.jsx)(n.a,{href:"https://www.cloudflare.com/",children:"https://www.cloudflare.com"})," to set one up."]}),"\n",(0,t.jsx)(n.h4,{id:"setup-1",children:"Setup"}),"\n",(0,t.jsx)(n.p,{children:"Once you are logged into Cloudflare. You can follow these steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:'Navigate to "Workers & Pages > Overview" in the left rail to create a new worker.'}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://github.com/statsig-io/statsig-kit/assets/95646168/39bcd1ad-ddcc-4be9-9d71-905ed6a90b8b",alt:"1-cloudflare-create"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"You may see a different experience if you already have workers on your account."})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:'Name you new worker whatever you would like and then click "Deploy".'}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://github.com/statsig-io/statsig-kit/assets/95646168/9d728e12-675e-4648-b6ee-ce84c72b305c",alt:"2-cloudflare-deploy"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:'Once deployed, click "Edit Code".'}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://github.com/statsig-io/statsig-kit/assets/95646168/8c971a58-5bb7-4faa-a7ba-4574ab29f0ce",alt:"3-cloudflare-edit-code"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Copy and paste the following snippet into the ",(0,t.jsx)(n.code,{children:"worker.js"}),' file, then hit "Deploy".']}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'export default {\n  async fetch(request, _env, _ctx) {\n    const url = new URL(request.url);\n\n    const original = new Request(request);\n    original.headers.delete("cookie");\n    return fetch(\n      `https://statsigapi.net${url.pathname}${url.search}`,\n      original\n    );\n  },\n};\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://github.com/statsig-io/statsig-kit/assets/95646168/558498dd-159f-409e-acef-a31e0dff86c2",alt:"4-cloudflare-paste-snippet"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Your worker should now be deployed and ready to use. See ",(0,t.jsx)(n.a,{href:"#using-your-proxy",children:"Using Your Proxy"})," for instructions on how to configure your Statsig SDK."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"using-your-proxy",children:"Using Your Proxy"}),"\n",(0,t.jsxs)(n.p,{children:["Once you have a proxy setup, you will need to take its URL and apply it to the SDK. To do this, you can use ",(0,t.jsx)(n.code,{children:"StatsigOptions.networkConfig.api"}),". You can visit ",(0,t.jsx)(n.a,{href:"/client/javascript-sdk#statsig-options",children:"Statsig Options"})," to read about the Javascript specific StatsigOptions, but all SDKs have the ability to override the api via ",(0,t.jsx)(n.code,{children:"StatsigOptions.networkConfig.api"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"The following is pseudo code of what initializing with a proxy looks like:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'Statsig.initialize(mySdkKey, myUser, {\n  networkConfig: {\n    api: "https://my-statsig-proxy.com/v1",\n  },\n});\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Depending on the SDK type, version, and proxy approach you are using, you may not need to append ",(0,t.jsx)(n.code,{children:"'/v1'"})," to the end of your api string. eg ",(0,t.jsx)(n.code,{children:'"https://my-statsig-proxy.com/"'})]})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(96540);const i={},o=t.createContext(i);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);