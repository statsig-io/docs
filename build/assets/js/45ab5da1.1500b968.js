"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[21434],{78248:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var n=i(74848),s=i(28453);const a={title:"Stratified Sampling",sidebar_label:"Stratified Sampling",slug:"/experiments-plus/stratified-sampling",keywords:["owner:vm"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},r=void 0,o={id:"experiments-plus/stratified-sampling",title:"Stratified Sampling",description:"What is Stratified Sampling",source:"@site/docs/experiments-plus/stratified-sampling.md",sourceDirName:"experiments-plus",slug:"/experiments-plus/stratified-sampling",permalink:"/experiments-plus/stratified-sampling",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/experiments-plus/stratified-sampling.md",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{title:"Stratified Sampling",sidebar_label:"Stratified Sampling",slug:"/experiments-plus/stratified-sampling",keywords:["owner:vm"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"cloud",previous:{title:"SPRT",permalink:"/experiments-plus/sprt"},next:{title:"Bonferroni Correction",permalink:"/stats-engine/methodologies/bonferroni-correction"}},l={},d=[{value:"What is Stratified Sampling",id:"what-is-stratified-sampling",level:2},{value:"Automated Stratified Sampling",id:"automated-stratified-sampling",level:2},{value:"How it works",id:"how-it-works",level:3},{value:"Enabling Stratified Sampling",id:"enabling-stratified-sampling",level:3},{value:"FAQ and Best Practices",id:"faq-and-best-practices",level:2},{value:"Manual assignment for Stratified Sampling",id:"manual-assignment-for-stratified-sampling",level:2},{value:"Additional reading",id:"additional-reading",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"what-is-stratified-sampling",children:"What is Stratified Sampling"}),"\n",(0,n.jsx)(t.p,{children:"Stratified sampling involves dividing the entire population into homogeneous groups called strata (plural for stratum). Random samples are then selected from each stratum. e.g. If you had XS and XL customers and randomized them into two groups - Control and Test, you'd want both Control and Test to be balanced across XS and XL customers. You can also stratify based on a metric like Revenue/User."}),"\n",(0,n.jsx)(t.p,{children:"With large numbers, randomization typically solves this. However in B2B scenarios and other relatively low volume or high variance scenarios, stratified sampling is useful to ensure this balance. Statsig supports both automated and manual stratified sampling. On tests where a tail-end of power users drive a large portion of an overall metric value, stratified sampling meaningfully reduces false positive rates and makes your results more consistent and trustworthy. In our simulations, we saw around a 50% decrease in the variance of reported results."}),"\n",(0,n.jsx)(t.h2,{id:"automated-stratified-sampling",children:"Automated Stratified Sampling"}),"\n",(0,n.jsx)(t.h3,{id:"how-it-works",children:"How it works"}),"\n",(0,n.jsxs)(t.p,{children:["The Statsig SDKs use a ",(0,n.jsx)(t.em,{children:"salt"})," to randomize or bucket experiment subjects (",(0,n.jsx)(t.a,{href:"/faq#how-does-bucketing-within-the-statsig-sdks-work",children:"learn more"}),'). When you enable stratified sampling, we\'ll try n different salts (100 for now) and evaluate how "balanced" your groups. We evaluate this balance based on either a metric you pick - or an attribute you give us describing your experiment subjects. We pick the best salt from this set and save this as the salt to use. ',(0,n.jsx)(t.a,{href:"https://statsig.com/blog/introducing-stratified-sampling",children:"Learn more"}),".\n",(0,n.jsx)(t.img,{src:"https://github.com/statsig-io/docs/assets/31516123/99f72b83-9f14-45a3-aa6e-ffcbd6211ec7",alt:"Stratified sampling algorithm diagram"})]}),"\n",(0,n.jsx)(t.p,{children:"The selection space for the salts is sufficiently large - stratifying multiple experiments on the same metric will not result in overlap. In the simulations we ran, the groups were as independent as expected which matched up with the literature here."}),"\n",(0,n.jsx)(t.h3,{id:"enabling-stratified-sampling",children:"Enabling Stratified Sampling"}),"\n",(0,n.jsxs)(t.p,{children:['You can enable this on experiment under Advanced Settings on the experiment setup page. There are two ways you can "stratify" on Statsig.\nIf you choose a metric to stratify using, we\'ll use that to balance the group.\n',(0,n.jsx)(t.img,{src:"https://github.com/statsig-io/docs/assets/31516123/0cfc499d-4fdf-44a8-ba2a-3537ba5bb904",alt:"Stratified sampling metric selection interface"})]}),"\n",(0,n.jsx)(t.p,{children:"If you instead choose an attribute or a classification (e.g. S, M, L, XL) we'll use that to balance the group."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"On Statsig Cloud, you'll upload a CSV (in Beta)"}),"\n",(0,n.jsxs)(t.li,{children:["On Statsig Warehouse Native, you'll use Entity Properties\n",(0,n.jsx)(t.img,{src:"https://github.com/statsig-io/docs/assets/31516123/102a839f-37fd-4443-807a-4b269f137490",alt:"Entity properties configuration for stratified sampling"})]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Once you press the Stratify button, we'll analyze a set of salts and pick the best one.\n",(0,n.jsx)(t.img,{src:"https://github.com/statsig-io/docs/assets/31516123/412f5c78-8c4f-4f16-88d3-60d3d3555ffd",alt:"Stratification analysis results interface"})]}),"\n",(0,n.jsx)(t.h2,{id:"faq-and-best-practices",children:"FAQ and Best Practices"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"What population is used when balancing?"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["When evaluating salts, Statsig computes balance using pre-experiment data for the entire targeted population of the experiment\u2019s unit type (e.g., all ",(0,n.jsx)(t.code,{children:"userID"}),"s or all ",(0,n.jsx)(t.code,{children:"customerID"}),"s) over the selected lookback window. There is no filtering on exposure because the experiment has not started yet."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"How are new units handled after stratification?"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Units that were not present in the pre-experiment data are still assigned deterministically by the chosen salt, i.e., effectively at random with respect to the balancing metric. They do not influence the salt selection and may introduce some drift from the initial balance."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Should I use stratified sampling for every experiment?"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Not necessarily. It\u2019s most useful when you expect imbalance due to heterogeneous units (e.g., \u201cwhales\u201d) or skewed metrics. The tradeoff is time/compute cost that scales with the number of units and adds steps before starting an experiment. If you don\u2019t expect meaningful imbalance, a standard random split is generally recommended."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Does salt evaluation assume 100% allocation? What about running at less than 100%?"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Yes. All candidate salts are evaluated assuming 100% of the targeted population is allocated. If you then run the experiment at an allocation below 100%, random sampling of that subset can reintroduce imbalance (e.g., by chance, some high-impact units may fall disproportionately into one arm). For the period you care most about inference, prefer 100% allocation to preserve the intended balance. Lower allocations are best used briefly for safe rollouts rather than for the full experiment duration."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Across candidate salts, is it the same set of users being evaluated?"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Yes. Candidate salts are assessed over the same targeted population; only the randomization induced by the salt changes."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"How long does stratification take?"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Duration depends on the number of units and the metric/source being queried. There is no fixed SLA; larger populations take longer."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"manual-assignment-for-stratified-sampling",children:"Manual assignment for Stratified Sampling"}),"\n",(0,n.jsxs)(t.p,{children:["When setting up an experiment, you can configure overrides (e.g. force user X or Segment A into Control, force user Y or Segment B into Test). This is meant for testing; overridden users are excluded from experimental analysis in Pulse results. If you do want manual assignment for stratified sampling, you should check the ",(0,n.jsx)(t.em,{children:"Include Overrides in Pulse"})," checkbox. This will include the users you've manually overridden into each variant in all metric lift analyses. You can configure 100% of experiment participants into your test variants manually, or configure some subset of participants into variants manually and randomly assign the rest of your participants."]}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsx)(t.p,{children:"While you can add overrides for an ID type that is different than the ID type of the experiment, those ID evaluations will not be resolved to the id type of the experiment and will not contribute to pulse results."})}),"\n",(0,n.jsx)(t.p,{children:"When you use the Statsig SDK for assignment, it takes care of randomization. When you control assignment of users, you're responsible for making sure users are balanced across experiment groups."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:"https://user-images.githubusercontent.com/31516123/230964234-8cc81f66-f4f8-4f37-b6df-6d36d0d7ab98.png",alt:"Manual assignment override configuration"})}),"\n",(0,n.jsx)(t.h2,{id:"additional-reading",children:"Additional reading"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://projecteuclid.org/journals/annals-of-statistics/volume-40/issue-2/Rerandomization-to-improve-covariate-balance-in-experiments/10.1214/12-AOS1008.full",children:"Morgan and Rubin 2012"}),' walks through the history, the philosophy, and the proofs of re-randomization, especially how re-randomization reduces the randomization variance of the difference in means. It\'s worth noting that "Standard asymptotic-based analysis procedures that do not take the re-randomization into account will be statistically conservative" was called out in the paper. However, to maintain consistent and comparable results across different methods, we stay conservative with the t-test.']}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://arxiv.org/abs/1906.11291",children:"Lin & Ding 2019"})," is another interesting read for your reference."]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},28453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>o});var n=i(96540);const s={},a=n.createContext(s);function r(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);