"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[15239],{64265:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>n,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var i=s(74848),r=s(28453);const a={title:"Metric Sources",slug:"/statsig-warehouse-native/configuration/metric-sources",sidebar_label:"Metric Sources",keywords:["owner:vm"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},n=void 0,o={id:"statsig-warehouse-native/configuration/metric-sources",title:"Metric Sources",description:"Metric Sources are how you schematize your warehouse data for Statsig, and they serve as the input data for metrics.",source:"@site/docs/statsig-warehouse-native/configuration/metric-sources.md",sourceDirName:"statsig-warehouse-native/configuration",slug:"/statsig-warehouse-native/configuration/metric-sources",permalink:"/statsig-warehouse-native/configuration/metric-sources",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/statsig-warehouse-native/configuration/metric-sources.md",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{title:"Metric Sources",slug:"/statsig-warehouse-native/configuration/metric-sources",sidebar_label:"Metric Sources",keywords:["owner:vm"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"warehouse",previous:{title:"Overview",permalink:"/statsig-warehouse-native/configuration/data-and-semantic-layer"},next:{title:"Overview",permalink:"/statsig-warehouse-native/configuration/metrics"}},c={},d=[{value:"What is a Metric Source",id:"what-is-a-metric-source",level:2},{value:"Data Sources",id:"data-sources",level:2},{value:"Getting Data",id:"getting-data",level:3},{value:"Configuring Data",id:"configuring-data",level:3},{value:"Types of Data",id:"types-of-data",level:3},{value:"Managing Metric Sources",id:"managing-metric-sources",level:2},{value:"Programmatic Updates",id:"programmatic-updates",level:3},{value:"Note - Governance",id:"note---governance",level:3},{value:"Daily Vs. Realtime Sources",id:"daily-vs-realtime-sources",level:2},{value:"(Very) Slow Metric Sources",id:"very-slow-metric-sources",level:2}];function l(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Metric Sources are how you schematize your warehouse data for Statsig, and they serve as the input data for metrics."}),"\n",(0,i.jsx)(t.h2,{id:"what-is-a-metric-source",children:"What is a Metric Source"}),"\n",(0,i.jsx)(t.p,{children:"A metric source is a key part of Statsig's semantic layer (and integrations to other Semantic Layers). A metric source consists of a data source, which is either:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"A SQL Query that will be read as a view"}),"\n",(0,i.jsx)(t.li,{children:"A warehouse table"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"And configuration around the source:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Required identifier and timestamp columns"}),"\n",(0,i.jsx)(t.li,{children:"Aliases, partition information"}),"\n",(0,i.jsx)(t.li,{children:"[Beta] Data quality checks and configuration"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"This is the gateway for your data to be used in parameterized queries for experiment analysis, analytics, and more within the Statsig console."}),"\n",(0,i.jsx)(t.h2,{id:"data-sources",children:"Data Sources"}),"\n",(0,i.jsx)(t.h3,{id:"getting-data",children:"Getting Data"}),"\n",(0,i.jsx)(t.p,{children:"Statsig Metric Sources can use a query or a table as the source of their data."}),"\n",(0,i.jsxs)(t.p,{children:["A query-based source will read a SQL query and use that as a source of truth. This, plus Statsig's built-in ",(0,i.jsx)(t.a,{href:"/statsig-warehouse-native/configuration/query-tools",children:"query macros"}),", provides an efficient and extremely flexible way to create experimental data sources."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://github.com/statsig-io/docs/assets/102695539/2cec3d01-f852-4007-aa3b-de276418593b",alt:"Screenshot 2024-06-11 at 2 56 22\u202fPM"})}),"\n",(0,i.jsx)(t.p,{children:'For larger or managed datasets, it\'s recommended to use table sources instead. This will minimize data scan and provides a more 1:1 mapping of "data source" to "metric source".'}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://github.com/statsig-io/docs/assets/102695539/04cb0209-580c-4603-a5db-45a08f00f90b",alt:"Screenshot 2024-06-11 at 2 56 26\u202fPM"})}),"\n",(0,i.jsx)(t.h3,{id:"configuring-data",children:"Configuring Data"}),"\n",(0,i.jsx)(t.p,{children:"For any source, you'll be asked to select which field to use for the timestamp of the logs/metrics being provided, as well as 1 to N user identifiers that can be used to join to experiment data."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://github.com/statsig-io/docs/assets/102695539/9a972d93-3500-4947-89e7-c144b877887f",alt:"Screenshot 2024-06-11 at 3 03 21\u202fPM"})}),"\n",(0,i.jsx)(t.p,{children:"For table sources, you can optionally provide a partitioning column to reduce data scan, and provide aliases to format data as desired and make your column names more human-readable."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://github.com/statsig-io/docs/assets/102695539/4b388fac-1124-4606-88f6-a0615bd32b18",alt:"Screenshot 2024-06-11 at 3 04 55\u202fPM"})}),"\n",(0,i.jsx)(t.h3,{id:"types-of-data",children:"Types of Data"}),"\n",(0,i.jsx)(t.p,{children:"Statsig works natively with many different types and granularities of data. Common patterns are:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"raw event logging, using the log timestamp as the timestamp"}),"\n",(0,i.jsx)(t.li,{children:"unit/day daily fact tables, using the date of the row as the timestamp"}),"\n",(0,i.jsx)(t.li,{children:"unit/day level summary tables, using the date of the row as the timestamp"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["For example, if you want to measure revenue, you might have one source for raw purchase logs. You could create a ",(0,i.jsx)(t.a,{href:"/statsig-warehouse-native/metrics/sum",children:"sum"})," metric on a ",(0,i.jsx)(t.code,{children:"PURCHASE_VALUE"})," field, adding whatever filters you want."]}),"\n",(0,i.jsxs)(t.p,{children:["You might also have a canonical user-level table that's used for dashboards and revenue reporting. You can easily use this, and make sure that it matches your core KPIs, by pointing to that table and creating a sum metric on the relevant column (e.g. ",(0,i.jsx)(t.code,{children:"REVENUE"}),")"]}),"\n",(0,i.jsx)(t.p,{children:"Both of these sources can be used interchangeably and simultaneously."}),"\n",(0,i.jsx)(t.h2,{id:"managing-metric-sources",children:"Managing Metric Sources"}),"\n",(0,i.jsx)(t.p,{children:"In the metric source tab, you can see your metric sources and the metrics/experiments they're being used in. This varies; in some cases, it can make sense to have a broad metric source that's reused with many metrics using different filters and aggregations. In others, a metric source might exist for one metric (such as a set of specific events for a funnel)."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://user-images.githubusercontent.com/102695539/264087800-18970974-b639-4d73-8977-e54de752ae0a.png",alt:"Metric Source Page"})}),"\n",(0,i.jsx)(t.h3,{id:"programmatic-updates",children:"Programmatic Updates"}),"\n",(0,i.jsxs)(t.p,{children:["You can create and modify metric sources via API and as part of your release flow for data systems. This is full-service and allows for the creation of read-only artifacts. Refer to the ",(0,i.jsx)(t.a,{href:"/statsig-warehouse-native/configuration/console-api",children:"console API"})," and ",(0,i.jsx)(t.a,{href:"/statsig-warehouse-native/configuration/semantic-layer-sync",children:"Semantic Layer Sync"})," sections."]}),"\n",(0,i.jsx)(t.h3,{id:"note---governance",children:"Note - Governance"}),"\n",(0,i.jsx)(t.p,{children:"If you are concerned about granting Statsig broad warehouse access, our recommended solution is to only give Statsig access\nto its own staging schema/dataset, and create views or materialize staging tables in that location for the data you want\nStatsig to see."}),"\n",(0,i.jsx)(t.h2,{id:"daily-vs-realtime-sources",children:"Daily Vs. Realtime Sources"}),"\n",(0,i.jsx)(t.p,{children:'When specifying a timestamp, you can also specify if the metric source contains data at a daily or timestamp granularity by toggling the "Treat Timestamp as Date" setting.'}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://github.com/statsig-io/docs/assets/102695539/f0edfdaf-9531-4583-b440-d05f0f3c3618",alt:"Timestamp granularity configuration interface"})}),"\n",(0,i.jsxs)(t.p,{children:["When this setting is ",(0,i.jsx)(t.strong,{children:"not"})," enabled, the system performs a timestamp-based join. This means that events are attributed to the experiment results based on the exact time they occur in relation to the exposure time. For example, if a user is exposed to an experiment at ",(0,i.jsx)(t.code,{children:"2024-01-01T11:00:00"})," and an event occurs at ",(0,i.jsx)(t.code,{children:"2024-01-01T11:01:00"})," on the same day, the event will be attributed to the experiment results because it happened after the exposure. Conversely, if the event occurs at ",(0,i.jsx)(t.code,{children:"2024-01-01T10:59:00"}),", just before the exposure, it will not be attributed to the experiment results since it happened prior to the exposure."]}),"\n",(0,i.jsx)(t.p,{children:'On the other hand, if the "Treat Timestamp as Date" setting is enabled, the system performs a date-based join. In this case, all events occurring on the same calendar day as the exposure, regardless of the time, will be included in the experiment results. This includes data from the first day of exposures, ensuring that day-1 metrics are not omitted from the analysis.'}),"\n",(0,i.jsx)(t.p,{children:"All Statsig needs to create metrics is a timestamp or date, and a unit (or user) identifier. Context fields let you pull multiple metrics from\nthe same base query, and select values to sum, mean, or group by."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Column Type"}),(0,i.jsx)(t.th,{children:"Description"}),(0,i.jsx)(t.th,{children:"Format/Rules"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"timestamp"}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.strong,{children:"Required"})," an identifier of when the metric data occurred"]}),(0,i.jsx)(t.td,{children:"Castable to Timestamp/Date"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"unit identifier"}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.strong,{children:"Required"})," At least one entity to which this metric belongs"]}),(0,i.jsx)(t.td,{children:"Generally a user ID or similar"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"additional identifiers"}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.em,{children:"Optional"})," Entity identifiers for reuse across identifier types"]}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"context columns"}),(0,i.jsxs)(t.td,{children:[(0,i.jsx)(t.em,{children:"Optional"})," Fields which will be aggregated, filtered, or grouped on"]}),(0,i.jsx)(t.td,{})]})]})]}),"\n",(0,i.jsx)(t.p,{children:"For example, you could pull from event logging and aggregate the event-level data to create metrics:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"timestamp"}),(0,i.jsx)(t.th,{children:"user_id"}),(0,i.jsx)(t.th,{children:"company_id"}),(0,i.jsx)(t.th,{children:"event"}),(0,i.jsx)(t.th,{children:"time_to_load"}),(0,i.jsx)(t.th,{children:"page_route"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2023-10-10 00:01:01"}),(0,i.jsx)(t.td,{children:"my_user_17503"}),(0,i.jsx)(t.td,{children:"c_22235455"}),(0,i.jsx)(t.td,{children:"page_load"}),(0,i.jsx)(t.td,{children:"207.22"}),(0,i.jsx)(t.td,{children:"/"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2023-10-10 00:02:15"}),(0,i.jsx)(t.td,{children:"my_user_18821"}),(0,i.jsx)(t.td,{children:"c_22235455"}),(0,i.jsx)(t.td,{children:"page_load"}),(0,i.jsx)(t.td,{children:"522.38"}),(0,i.jsx)(t.td,{children:"/search"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2023-10-10 00:02:22"}),(0,i.jsx)(t.td,{children:"my_user_18821"}),(0,i.jsx)(t.td,{children:"c_22235455"}),(0,i.jsx)(t.td,{children:"serp_click"}),(0,i.jsx)(t.td,{children:"null"}),(0,i.jsx)(t.td,{children:"/search"})]})]})]}),"\n",(0,i.jsx)(t.p,{children:"You could create an average TTL metric by averaging time_to_load, and group it by page route or filter to specific routes when creating your metric."}),"\n",(0,i.jsx)(t.p,{children:"As another example, you might pre-calculate some metrics yourself at a user-day grain - either to match your source-of-truth exactly or to add more complex logical fields:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"timestamp"}),(0,i.jsx)(t.th,{children:"user_id"}),(0,i.jsx)(t.th,{children:"company_id"}),(0,i.jsx)(t.th,{children:"country"}),(0,i.jsx)(t.th,{children:"page_loads"}),(0,i.jsx)(t.th,{children:"satisfaction_score"}),(0,i.jsx)(t.th,{children:"revenue_usd"}),(0,i.jsx)(t.th,{children:"net_revenue_usd"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2023-10-10"}),(0,i.jsx)(t.td,{children:"my_user_17503"}),(0,i.jsx)(t.td,{children:"c_22235455"}),(0,i.jsx)(t.td,{children:"US"}),(0,i.jsx)(t.td,{children:"13"}),(0,i.jsx)(t.td,{children:"9"}),(0,i.jsx)(t.td,{children:"130.21"}),(0,i.jsx)(t.td,{children:"112.33"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2023-10-10"}),(0,i.jsx)(t.td,{children:"my_user_18821"}),(0,i.jsx)(t.td,{children:"c_22235455"}),(0,i.jsx)(t.td,{children:"CA"}),(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"0"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2023-10-10"}),(0,i.jsx)(t.td,{children:"my_user_18828"}),(0,i.jsx)(t.td,{children:"c_190887"}),(0,i.jsx)(t.td,{children:"DE"}),(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"null"}),(0,i.jsx)(t.td,{children:"22.1"}),(0,i.jsx)(t.td,{children:"0"})]})]})]}),"\n",(0,i.jsx)(t.p,{children:"You can create different metrics by summing and filtering on those daily fields."}),"\n",(0,i.jsx)(t.h2,{id:"very-slow-metric-sources",children:"(Very) Slow Metric Sources"}),"\n",(0,i.jsx)(t.p,{children:"Statsig uses techniques like Statsig macros, push-down-filters (predicate filters) and using partition keys to make queries in your warehouse efficient. While Metric Sources can include joins or complex queries, they should be performant. If they are not - using any metrics based off this metric source will become expensive (or cause timeouts and failures). The same is true for assignment sources."}),"\n",(0,i.jsx)(t.p,{children:"Statsig will flag a metric source as slow if it takes more than 30 seconds to retrieve a sample of up to 100 records from the table. If the query is expensive, we recommend considering the following steps in sequence to optimize for your metric source:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Include filters based off partition column"}),"\n",(0,i.jsxs)(t.li,{children:["Use ",(0,i.jsx)(t.a,{href:"https://docs.statsig.com/statsig-warehouse-native/guides/best-practices#use-statsigs-macros",children:"Statsig macros"})," in SQL"]}),"\n",(0,i.jsx)(t.li,{children:"Pre-calculate some of the metrics to avoid joins or complex queries"}),"\n",(0,i.jsx)(t.li,{children:"(Do this cautiously) Upgrade your computing resources if you are on a very small cluster."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"(Note: if you were flagged for a slow Assignment Source, the same guidance here applies to that too!)"})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>n,x:()=>o});var i=s(96540);const r={},a=i.createContext(r);function n(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:n(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);