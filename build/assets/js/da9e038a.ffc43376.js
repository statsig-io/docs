"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[6682],{72343:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var s=n(74848),i=n(28453),o=n(22897);const r={sidebar_label:"Serverless",title:"Using Statsig in Serverless Environments",keywords:["owner:brock"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},a=void 0,l={id:"guides/serverless",title:"Using Statsig in Serverless Environments",description:"In this guide, we will walk you through how to leverage Statsig\u2019s platform in serverless environments.  The examples in this guide use the statsig-node SDK in a Google Cloud Function.",source:"@site/docs/guides/serverless.mdx",sourceDirName:"guides",slug:"/guides/serverless",permalink:"/guides/serverless",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/guides/serverless.mdx",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{sidebar_label:"Serverless",title:"Using Statsig in Serverless Environments",keywords:["owner:brock"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"cloud",previous:{title:"Exports Overview",permalink:"/integrations/data-exports/overview"},next:{title:"CDN Edge Testing",permalink:"/guides/cdn-edge-testing"}},d={},c=[{value:"Usage",id:"usage",level:3},{value:"Example",id:"example",level:3},{value:"Alternatives",id:"alternatives",level:3},{value:"Fastly Implementation",id:"fastly-implementation",level:3}];function u(e){const t={a:"a",code:"code",h3:"h3",p:"p",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["In this guide, we will walk you through how to leverage Statsig\u2019s platform in serverless environments.  The examples in this guide use the ",(0,s.jsx)(t.code,{children:"statsig-node"})," SDK in a Google Cloud Function.\nThese details shouldn't matter - but you may have to adjust your implementation based on your cloud provider of choice."]}),"\n",(0,s.jsx)(t.h3,{id:"usage",children:"Usage"}),"\n",(0,s.jsxs)(t.p,{children:["Statsig server SDKs can be used in serverless environments.  If you are unable to ",(0,s.jsx)(t.code,{children:"initialize"})," Statsig outside of a serverless function, you will incur a server round trip to Statsig servers to initialize the SDK in every function."]}),"\n",(0,s.jsx)(t.p,{children:"After this point, all checks should be locally evaluated in the function."}),"\n",(0,s.jsxs)(t.p,{children:["Finally, you'll need to ensure any enqueued events (exposure and custom events) are flushed to Statsig prior to the function exiting. You'll need to call ",(0,s.jsx)(t.code,{children:"statsig.flush()"})," as demonstrated ",(0,s.jsx)(t.a,{href:"/server/nodejsServerSDK#flushing-events-",children:"here"})," using the Cloudflare flavor."]}),"\n",(0,s.jsx)(t.h3,{id:"example",children:"Example"}),"\n",(0,s.jsxs)(t.p,{children:["The following example has some debugging information built in to show the cost of initializing the SDK in a cloud function.  In our experience, the ",(0,s.jsx)(t.code,{children:"initialize"})," call takes less than a second, and subsequent function invocations should proceed without this startup cost."]}),"\n","\n",(0,s.jsx)(o.A,{id:"bc759e43fd3fbac4619e5635d8ba9353"}),"\n",(0,s.jsx)(t.h3,{id:"alternatives",children:"Alternatives"}),"\n",(0,s.jsx)(t.p,{children:"If this doesn't work for you, a custom integration may help but would require additional setup."}),"\n",(0,s.jsx)(t.p,{children:"For example, you could create a background function which fetches your definitions from Statsig servers periodically, and stores them in your database.\nThen, when initializing a Statsig server SDK, you can fetch the values from your database, rather than issuing a request to Statsig servers."}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://www.statsig.com/slack",children:"Reach out to us in Slack"})," if you want to talk through how to make Statsig play nicely with your architecture and requirements!"]}),"\n",(0,s.jsx)(t.h3,{id:"fastly-implementation",children:"Fastly Implementation"}),"\n",(0,s.jsxs)(t.p,{children:["Depending on your Fastly account settings, you may have an extra layer of security enabled which requires a custom ",(0,s.jsx)(t.code,{children:"fetch"})," method to be implemented for any network requests that need to be made to 3rd party domains. You must implement a custom ",(0,s.jsx)(t.code,{children:"fetch"})," method that uses Fastly's required ",(0,s.jsx)(t.a,{href:"https://js-compute-reference-docs.edgecompute.app/docs/globals/fetch",children:"backend parameter"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["To solve for this, first define a module in its own file that implements a global override of ",(0,s.jsx)(t.code,{children:"fetch"}),":"]}),"\n",(0,s.jsx)(o.A,{id:"b5d09f889465021f999582d1f48ef187"}),"\n",(0,s.jsx)(t.p,{children:"Next, in the main function entrypoint, simply import the fetch override module prior to importing the Statsig SDK:"}),"\n",(0,s.jsx)(o.A,{id:"f4a61c369ea03b24ffb8aecb9175bdcb"})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},22897:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(96540);function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}const o=function(e){var t,n;function o(){return e.apply(this,arguments)||this}n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,i(t,n);var r=o.prototype;return r.componentDidMount=function(){this._updateIframeContent()},r.componentDidUpdate=function(e,t){this._updateIframeContent()},r._defineUrl=function(){var e=this.props,t=e.id,n=e.file;return"https://gist.github.com/"+t+".js"+(n?"?file="+n:"")},r._updateIframeContent=function(){var e=this.props,t=e.id,n=e.file,s=this.iframeNode,i=s.document;s.contentDocument?i=s.contentDocument:s.contentWindow&&(i=s.contentWindow.document);var o='<html><head><base target="_parent"><style>*{font-size:12px;}</style></head><body '+("onload=\"parent.document.getElementById('"+(n?"gist-"+t+"-"+n:"gist-"+t)+"').style.height=document.body.scrollHeight + 'px'\"")+">"+('<script type="text/javascript" src="'+this._defineUrl()+'"><\/script>')+"</body></html>";i.open(),i.writeln(o),i.close()},r.render=function(){var e=this,t=this.props,n=t.id,i=t.file;return s.createElement("iframe",{ref:function(t){e.iframeNode=t},width:"100%",frameBorder:0,id:i?"gist-"+n+"-"+i:"gist-"+n})},o}(s.PureComponent)},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var s=n(96540);const i={},o=s.createContext(i);function r(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);