"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[30687],{55577:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var t=n(74848),i=n(28453);const a={sidebar_label:"ExpressJS Feature Flags",title:"Feature Flags in NodeJS ExpressJS",keywords:["owner:brock"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},r=void 0,o={id:"guides/node-express-feature-flags",title:"Feature Flags in NodeJS ExpressJS",description:"ExpressJS, renowned for its efficiency and minimalist design, is a cornerstone framework for NodeJS developers. This guide focuses on integrating feature flags in NodeJS ExpressJS applications using Statsig's NodeJS Server SDK. Discover how to enhance your ExpressJS app with feature flags for flexible and dynamic user experiences.",source:"@site/docs/guides/node-express-feature-flags.mdx",sourceDirName:"guides",slug:"/guides/node-express-feature-flags",permalink:"/guides/node-express-feature-flags",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/guides/node-express-feature-flags.mdx",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{sidebar_label:"ExpressJS Feature Flags",title:"Feature Flags in NodeJS ExpressJS",keywords:["owner:brock"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"api",previous:{title:"Target Apps",permalink:"/sdk-keys/target-apps"},next:{title:"ExpressJS Experiments",permalink:"/guides/node-express-abtests"}},d={},l=[{value:"Create Feature Gate in Statsig for NodeJS ExpressJS Applications",id:"create-feature-gate-in-statsig-for-nodejs-expressjs-applications",level:2},{value:"Project Outline",id:"project-outline",level:2},{value:"Initializing Statsig SDK in Your ExpressJS App",id:"initializing-statsig-sdk-in-your-expressjs-app",level:2},{value:"Managing User Identity",id:"managing-user-identity",level:2},{value:"Check Gate Assignment for Page Render",id:"check-gate-assignment-for-page-render",level:2},{value:"Leveraging Feature Flags in NodeJS ExpressJS HTML Templates",id:"leveraging-feature-flags-in-nodejs-expressjs-html-templates",level:2}];function c(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"ExpressJS, renowned for its efficiency and minimalist design, is a cornerstone framework for NodeJS developers. This guide focuses on integrating feature flags in NodeJS ExpressJS applications using Statsig's NodeJS Server SDK. Discover how to enhance your ExpressJS app with feature flags for flexible and dynamic user experiences."}),"\n",(0,t.jsxs)(s.p,{children:["For this tutorial, let's integrate our ",(0,t.jsx)(s.a,{href:"/server/nodejsServerSDK",children:"NodeJS Server SDK"})," into a simple expressJS app and check a feature gate to determine if the end-user should see a new feature."]}),"\n",(0,t.jsxs)(s.admonition,{type:"tip",children:[(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.a,{href:"https://github.com/statsig-io/samples/tree/node-express/node-express#node-express-statsig-demo-app",children:"ExpressJS + Statsig Sample App source code here"}),"."]}),(0,t.jsx)(s.p,{children:"The readme within details the steps on installing the app and its dependencies, setting the necessary environment variables, and running the app. Those concepts won't be covered in this guide because they are standard NodeJS practices."})]}),"\n",(0,t.jsx)(s.h2,{id:"create-feature-gate-in-statsig-for-nodejs-expressjs-applications",children:"Create Feature Gate in Statsig for NodeJS ExpressJS Applications"}),"\n",(0,t.jsxs)(s.p,{children:["The below command can be run to automatically create the simple ",(0,t.jsx)(s.code,{children:"express_app_bg"})," gate in Statsig that gets used throughout this integration guide and demo app."]}),"\n",(0,t.jsxs)(s.p,{children:["The gate randomizes based on ",(0,t.jsx)(s.code,{children:"userID"})," and has a 50/50 allocation. Make sure to replace the authorization key in the header with your key generated in Statsig project settings as documented ",(0,t.jsx)(s.a,{href:"/console-api/introduction",children:"here"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'curl --request POST \'https://statsigapi.net/console/v1/gates\' \\\n--header \'STATSIG-API-KEY: console-REPLACE_WITH_YOURS\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{"name":"express_app_bg","idType":"userID","isEnabled":true,"rules":[{"name":"Everyone","passPercentage":50,"conditions":[{"type":"public"}]}]}\'\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Feature gate configuration interface",src:n(87860).A+"",width:"1892",height:"464"})}),"\n",(0,t.jsx)(s.h2,{id:"project-outline",children:"Project Outline"}),"\n",(0,t.jsxs)(s.p,{children:["This example was built on the very simple ",(0,t.jsx)(s.a,{href:"https://expressjs.com/en/starter/hello-world.html",children:"Hello World"})," example app documented by ExpressJS.\nThe main server entrypoint is ",(0,t.jsx)(s.code,{children:"app.js"})," and the demo webpage source follows the handlebars standard, living in ",(0,t.jsx)(s.code,{children:"views/index.hbs"}),"."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"ExpressJS project folder structure",src:n(35385).A+"",width:"1646",height:"408"})}),"\n",(0,t.jsxs)(s.p,{children:["Aside from ",(0,t.jsx)(s.code,{children:"statsig-node"}),", this example app requires several node modules, including:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"cookie-parser"})," for managing cookies for user identity"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"uuidv4"})," for generating a random uuid"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"express"})," as the NodeJS web framework"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"express-handlebars"})," as the template engine"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"dotenv"})," for secret management"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"initializing-statsig-sdk-in-your-expressjs-app",children:"Initializing Statsig SDK in Your ExpressJS App"}),"\n",(0,t.jsx)(s.p,{children:"Every expressJS app has the call to boot the server and listen for requests. This is a convenient place to initialize the Statsig SDK.\nHere is an example of how that can be achieved:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"app.listen(port, async () => {\n  const runtimeEnv = process.env.STATSIG_ENV_TIER || 'production';\n  await statsig.initialize(process.env.STATSIG_SERVER_KEY, {\n    environment: { tier: runtimeEnv },\n  });\n  console.log(`Example app listening in ${runtimeEnv} on port ${port}`);\n});\n"})}),"\n",(0,t.jsx)(s.h2,{id:"managing-user-identity",children:"Managing User Identity"}),"\n",(0,t.jsx)(s.p,{children:"Any Statsig SDK method call requires a userObject to be passed in. Efficient user identity management is key to implementing feature flags in NodeJS ExpressJS."}),"\n",(0,t.jsx)(s.p,{children:"For known users that are logged in and an identity is accessible, this is trivial. In the case where identity isn't available, it's ideal to either (a) read an existing cookie ID available to the app or (b) create and use a new uid for the purposes of anonymous assignment within the Statsig SDK."}),"\n",(0,t.jsx)(s.p,{children:"ExpressJS offers a convenient middleware pattern that allows this business logic to be defined once, and it can be used globally in any route handler. Here is an example of what that looks like:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.em,{children:["Generating and setting an anonymous uid requires installing ",(0,t.jsx)(s.code,{children:"uuidv4"})," and ",(0,t.jsx)(s.code,{children:"cookie-parser"})," module"]})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"// earlier in the source, prior to app.listen call\napp.use(cookieParser());\n\n/**\n* global middleware to set a cookie if it doesn't exist\n* passes the uuid down to route handlers on req object\n*/\napp.use(async (req, res, next) => {\n  let statsigDeviceID;\n  if (req.cookies['statsig_uuid']) {\n    statsigDeviceID = req.cookies['statsig_uuid'];\n  }\n  else {\n    statsigDeviceID = uuidv4();\n    res.cookie('statsig_uuid', statsigDeviceID);\n  }\n  req.statsigDeviceID = statsigDeviceID;\n  next();\n});\n"})}),"\n",(0,t.jsx)(s.h2,{id:"check-gate-assignment-for-page-render",children:"Check Gate Assignment for Page Render"}),"\n",(0,t.jsxs)(s.p,{children:["In your route handler, you will have access to the global ",(0,t.jsx)(s.code,{children:"statsig"})," singleton. Whenever you need to check a gate, you can simply call ",(0,t.jsx)(s.code,{children:"statsig.checkGate"})," and pass in the user object."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"app.get('/', async (req, res) => {\n  const user = {\n    // use the random uuid in cookie as the userID\n    // in practice, you'd use a known userID here\n    userID: req.statsigDeviceID,\n    country: 'US',\n    // pass any known user attribute here\n    custom: {\n      employee: true\n    }\n  };\n  res.render('index.hbs', { \n    backgroundFeatureEnabled: statsig.checkGate(user, 'express_app_bg')\n  });\n});\n"})}),"\n",(0,t.jsx)(s.h2,{id:"leveraging-feature-flags-in-nodejs-expressjs-html-templates",children:"Leveraging Feature Flags in NodeJS ExpressJS HTML Templates"}),"\n",(0,t.jsxs)(s.p,{children:["The template will be rendered and with access to the ",(0,t.jsx)(s.code,{children:"backgroundFeatureEnabled"})," (boolean) variable, which gets used in the handlebars ",(0,t.jsx)(s.code,{children:"{{#if}}"})," operator to conditionally set a background image on the page. The rendered template will be served to the user as an HTML document."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-hbs",children:'<body{{#if backgroundFeatureEnabled}} class="has-bg"{{/if}}>\n<div id="main">\n    <h1>Statsig sample Express app</h1>\n    <h3>\n        {{#if backgroundFeatureEnabled}}\n        You are in the <code>express_app_bg</code> feature gate. (Statsig page background)\n        {{else}}\n        You are not in the <code>express_app_bg</code> feature gate (no page background) \n        {{/if}}\n    </h3>\n</div>\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"ExpressJS app with feature flag enabled",src:n(85544).A+"",width:"1382",height:"846"})})]})}function p(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},35385:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/express-folder-structure-725819caa7b52fa954dd13473fdd28eb.png"},87860:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/express-gate-ab68cf8278790567c5585df36f9600cc.png"},85544:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/express-page-19016d13e042434db65a00b0aec07f75.png"},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>o});var t=n(96540);const i={},a=t.createContext(i);function r(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);