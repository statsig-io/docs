"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[70186],{49543:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var i=n(74848),s=n(28453);const a={title:"Server Data Stores  / Data Adapter",sidebar_label:"Server Data Stores",slug:"/server/concepts/data_store",keywords:["owner:brock"],last_update:{date:new Date("2025-09-08T00:00:00.000Z")}},o=void 0,r={id:"server/concepts/data_store",title:"Server Data Stores  / Data Adapter",description:"One common question when configuring Statsig is how to design your integration around handling potential points of failure. For example - in case of a Statsig API outage, can my integration continue to function?",source:"@site/docs/server/concepts/data_store.mdx",sourceDirName:"server/concepts",slug:"/server/concepts/data_store",permalink:"/server/concepts/data_store",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/server/concepts/data_store.mdx",tags:[],version:"current",lastUpdatedAt:17572896e5,frontMatter:{title:"Server Data Stores  / Data Adapter",sidebar_label:"Server Data Stores",slug:"/server/concepts/data_store",keywords:["owner:brock"],last_update:{date:"2025-09-08T00:00:00.000Z"}},sidebar:"api",previous:{title:"Local Eval Adapter",permalink:"/client/concepts/local-eval-adapter"},next:{title:"Target Apps",permalink:"/sdk-keys/target-apps"}},d={},c=[{value:"DataAdapter (or DataStore)",id:"dataadapter-or-datastore",level:2},{value:"Recommended Implementation",id:"recommended-implementation",level:3},{value:"Data Adapter Logic",id:"data-adapter-logic",level:3}];function l(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"One common question when configuring Statsig is how to design your integration around handling potential points of failure. For example - in case of a Statsig API outage, can my integration continue to function?"}),"\n",(0,i.jsxs)(t.p,{children:["The short answer is yes. Your server SDK will continue to operate normally, serving the most recent set of known values in response to calls like ",(0,i.jsx)(t.code,{children:"checkGate"}),", ",(0,i.jsx)(t.code,{children:"getConfig"}),", ",(0,i.jsx)(t.code,{children:"getExperiment"}),", and ",(0,i.jsx)(t.code,{children:"getLayer"}),".\nOnce the API is back up and operating normally, your SDK will automatically refetch the most up-to-date version of your project."]}),"\n",(0,i.jsx)(t.p,{children:"But what about spinning up a new server, or a new SDK instance, while Statsig is down?"}),"\n",(0,i.jsxs)(t.p,{children:["This is what we built the ",(0,i.jsx)(t.code,{children:"DataAdapter"}),"/",(0,i.jsx)(t.code,{children:"DataStore"})," for."]}),"\n",(0,i.jsx)(t.h2,{id:"dataadapter-or-datastore",children:"DataAdapter (or DataStore)"}),"\n",(0,i.jsxs)(t.p,{children:["DataAdapters allow you to plug in your own storage solution as a cache that the Statsig Server SDKs use to load your project configurations (ie; all experiments, configs, gates and their targeting/allocation rules). Some of the key use-cases for Data Adapter are: reducing dependency on Statsig servers for initialization, improving initialization time by loading config from a local data store, and providing customers with controls for minimizing network I/O. Data Adapters define a simple API that you have to implement: ",(0,i.jsx)(t.code,{children:"initialize"}),", ",(0,i.jsx)(t.code,{children:"get"}),", ",(0,i.jsx)(t.code,{children:"set"}),", and ",(0,i.jsx)(t.code,{children:"shutdown"})," for setup, reading, writing, and closing."]}),"\n",(0,i.jsx)(t.h3,{id:"recommended-implementation",children:"Recommended Implementation"}),"\n",(0,i.jsxs)(t.p,{children:["In most cases, ",(0,i.jsxs)(t.strong,{children:["your webservers should only implement the read path (",(0,i.jsx)(t.code,{children:"get"}),")"]}),".",(0,i.jsx)(t.br,{}),"\n","Leaving the write path (",(0,i.jsx)(t.code,{children:"set"}),") empty is the best practice. Otherwise, every SDK instance across all of your servers will attempt to write to the store whenever it sees an update, which is inefficient and can lead to unnecessary contention or duplication."]}),"\n",(0,i.jsx)(t.p,{children:"Instead, you should have a single source of truth that keeps your datastore up-to-date:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Run a ",(0,i.jsx)(t.strong,{children:"separate out-of-band service"})," that implements the SDK and is responsible for writing updates into the datastore via ",(0,i.jsx)(t.code,{children:"set"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Or, use a ",(0,i.jsx)(t.strong,{children:"cron job / periodic job"})," to fetch the config from the Statsig CDN endpoint and update your datastore under the correct cache keys (",(0,i.jsx)(t.code,{children:"statsig.cache"}),", ",(0,i.jsx)(t.code,{children:"statsig.id_lists"}),", and ",(0,i.jsx)(t.code,{children:"statsig.id_lists::{list_name}"}),")."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"The Statsig SDK already handles this refresh logic out of the box, so separating the read and write responsibilities is the cleanest and most reliable pattern."}),"\n",(0,i.jsx)(t.h3,{id:"data-adapter-logic",children:"Data Adapter Logic"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["When the Statsig SDK is initialized with a DataAdapter, it will first attempt to load config via ",(0,i.jsx)(t.code,{children:"DataAdapter.get"}),".","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"If the entry exists, it will use it."}),"\n",(0,i.jsxs)(t.li,{children:["If the entry does not exist, and ",(0,i.jsx)(t.code,{children:"localMode"})," is not enabled, it will fetch the config from Statsig servers and (if you have a writer service) persist it via ",(0,i.jsx)(t.code,{children:"DataAdapter.set"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["Post-initialization, the SDK will continue to poll Statsig servers for updates and, when available, save them back to your data store (if you\u2019ve implemented ",(0,i.jsx)(t.code,{children:"set"})," and designated a writer service)."]}),"\n",(0,i.jsxs)(t.li,{children:["If the SDK client is initialized with ",(0,i.jsx)(t.code,{children:"localMode=true"}),", this will disable all network fetches from Statsig."]}),"\n",(0,i.jsxs)(t.li,{children:["The cache keys used to be:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"statsig.cache"})," \u2192 config specs"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"statsig.id_lists"})," \u2192 lookup of id lists"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"statsig.id_lists::{list_name}"})," \u2192 actual id list values"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["but in the latest node and server core sdks, the format has changed:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"statsig|{path}|{format}|{hashedSDKKey}"})," where ",(0,i.jsx)(t.code,{children:"path"})," is ",(0,i.jsx)(t.code,{children:"/v1/download_config_specs"})," or ",(0,i.jsx)(t.code,{children:"/v1/get_id_lists"}),", format is ",(0,i.jsx)(t.code,{children:"plain_text"}),", and the ",(0,i.jsx)(t.code,{children:"djb2"})," has of the sdk key is the last bit"]}),"\n",(0,i.jsx)(t.li,{children:"the SDK will handle this for you, reach out if you are trying to recreate this path yourself to double check"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.admonition,{type:"note",children:[(0,i.jsxs)(t.p,{children:["Most DataAdapters are currently only used for the ",(0,i.jsx)(t.code,{children:"initialize"})," path for getting a project definition."]}),(0,i.jsxs)(t.p,{children:["At the time of this writing, only ",(0,i.jsx)(t.code,{children:"Node.js"}),", ",(0,i.jsx)(t.code,{children:"Ruby"}),", ",(0,i.jsx)(t.code,{children:"Go"}),", ",(0,i.jsx)(t.code,{children:"Java"})," and ",(0,i.jsx)(t.code,{children:".NET"})," support polling for updates.",(0,i.jsx)(t.br,{}),"\n","If you're interested in using a DataAdapter as the source of truth indefinitely, please reach out in our ",(0,i.jsx)(t.a,{href:"https://statsig.com/slack",children:"Slack community"})," and let us know which language this would be useful for!"]})]}),"\n",(0,i.jsx)(t.p,{children:"For information on your specific SDK language, see the language-specific docs in the left-hand column."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var i=n(96540);const s={},a=i.createContext(s);function o(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);