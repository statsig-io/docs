"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[94011],{60951:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>g});var a=n(74848),s=n(28453);const i={title:"Google Tag Manager (GTM)",keywords:["owner:brock"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},o=void 0,r={id:"integrations/gtm",title:"Google Tag Manager (GTM)",description:"Inbound Integration (Events flow from GTM dataLayer to Statsig)",source:"@site/docs/integrations/gtm.md",sourceDirName:"integrations",slug:"/integrations/gtm",permalink:"/integrations/gtm",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/integrations/gtm.md",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{title:"Google Tag Manager (GTM)",keywords:["owner:brock"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"cloud",previous:{title:"Data Mapping",permalink:"/data-warehouse-ingestion/data_mapping"},next:{title:"Event Filtering",permalink:"/integrations/event_filtering"}},c={},g=[{value:"Inbound Integration (Events flow from GTM dataLayer to Statsig)",id:"inbound-integration-events-flow-from-gtm-datalayer-to-statsig",level:2},{value:"Setup",id:"setup",level:2},{value:"Step 1: Broadcast Statsig client readiness to GTM",id:"step-1-broadcast-statsig-client-readiness-to-gtm",level:3},{value:"Using @statsig/js-client",id:"using-statsigjs-client",level:4},{value:"Using statsig-js",id:"using-statsig-js",level:4},{value:"Step 2: Create new tag",id:"step-2-create-new-tag",level:3},{value:"Step 3: Choose tag type",id:"step-3-choose-tag-type",level:3},{value:"Step 4: Adjust fire options",id:"step-4-adjust-fire-options",level:3},{value:"Step 5: Set Tag Trigger",id:"step-5-set-tag-trigger",level:3},{value:"Step 6: Save tag and test",id:"step-6-save-tag-and-test",level:3},{value:"GTM Code",id:"gtm-code",level:3},{value:"Outbound Integration (GTM Data is enriched with Statsig test assignments)",id:"outbound-integration-gtm-data-is-enriched-with-statsig-test-assignments",level:2}];function l(t){const e={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",...(0,s.R)(),...t.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h2,{id:"inbound-integration-events-flow-from-gtm-datalayer-to-statsig",children:"Inbound Integration (Events flow from GTM dataLayer to Statsig)"}),"\n",(0,a.jsx)(e.p,{children:"This integration will allow customers using Statsig on the web to leverage their existing Google Tag manager configuration to track events to Statsig. This saves customers from having to retag their web properties with calls specific to Statsig's SDK. This integration uses a global listener to consume all GTM triggers and dispatch a corresponding event back to Statsig."}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.img,{alt:"Statsig log stream showing GTM events",src:n(12509).A+"",width:"1714",height:"642"}),"\n",(0,a.jsx)(e.em,{children:"(statsig log stream showing GTM events flowing in)"})]}),"\n",(0,a.jsx)(e.h2,{id:"setup",children:"Setup"}),"\n",(0,a.jsx)(e.h3,{id:"step-1-broadcast-statsig-client-readiness-to-gtm",children:"Step 1: Broadcast Statsig client readiness to GTM"}),"\n",(0,a.jsxs)(e.p,{children:["The tracking code within GTM will need to know when the Statsig client is ready to use for tracking. To do so, you'll need to broadcast a window-level event and pass the statsig instance for the GTM tag code to use. In your initialize call, implement the ",(0,a.jsx)(e.code,{children:"initCompletionCallback"})," callback as follows:"]}),"\n",(0,a.jsx)(e.h4,{id:"using-statsigjs-client",children:"Using @statsig/js-client"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-js",children:"window.statsig = new Statsig.StatsigClient('<CLIENT-SDK-KEY>', {/* USER */}, {/* OPTIONS */});\nstatsig.on('values_updated', function(evt) { // bind before init is called\n  if(evt.status && evt.status === 'Ready') {\n    window.dispatchEvent(new CustomEvent(\"statsig:ready\", {\n      detail: { statsig: statsig }\n    }));        \n  }\n});\nawait statsig.initializeAsync();\n"})}),"\n",(0,a.jsx)(e.h4,{id:"using-statsig-js",children:"Using statsig-js"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-js",children:"await statsig.initialize('<CLIENT-SDK-KEY>', '<USER-OBJECT>', {\n  initCompletionCallback: function (duration, success, message) {\n    window.dispatchEvent(new CustomEvent(\"statsig:ready\", {\n      detail: { statsig: statsig }\n    }));\n  }\n}); \n"})}),"\n",(0,a.jsx)(e.h3,{id:"step-2-create-new-tag",children:"Step 2: Create new tag"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"GTM create new tag interface",src:n(18376).A+"",width:"2058",height:"550"})}),"\n",(0,a.jsx)(e.h3,{id:"step-3-choose-tag-type",children:"Step 3: Choose tag type"}),"\n",(0,a.jsxs)(e.p,{children:['Choose "Custom HTML" for tag type, and paste ',(0,a.jsx)(e.a,{href:"#gtm-code",children:"this GTM code"})," (including script tag)"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"GTM tag configuration screen",src:n(63694).A+"",width:"2170",height:"736"})}),"\n",(0,a.jsx)(e.h3,{id:"step-4-adjust-fire-options",children:"Step 4: Adjust fire options"}),"\n",(0,a.jsx)(e.p,{children:'Under Advanced Settings under "Tag Firing options", select "Once per page"'}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"GTM tag firing options settings",src:n(32805).A+"",width:"1700",height:"920"})}),"\n",(0,a.jsx)(e.h3,{id:"step-5-set-tag-trigger",children:"Step 5: Set Tag Trigger"}),"\n",(0,a.jsx)(e.p,{children:'Below the "Tag Configuration" section, set the Trigger to "Initialization - All Pages" Option.'}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"GTM tag trigger configuration",src:n(11864).A+"",width:"2106",height:"430"})}),"\n",(0,a.jsx)(e.h3,{id:"step-6-save-tag-and-test",children:"Step 6: Save tag and test"}),"\n",(0,a.jsxs)(e.p,{children:["After saving the tag, and publishing your updated GTM tag, tracking will be done automatically without any additional configuration.\nTo debug the integration, you can set a local storage entry ",(0,a.jsx)(e.code,{children:"debug_ss_gtm"})," with any value on your webpage. Now, you'll console log statements for each tracking call being dispatched to Statsig. You can also inspect your browser's network traffic to see events being tracked."]}),"\n",(0,a.jsx)(e.h3,{id:"gtm-code",children:"GTM Code"}),"\n",(0,a.jsx)(e.admonition,{type:"info",children:(0,a.jsxs)(e.p,{children:["The code below assumes that the statsig client lives at ",(0,a.jsx)(e.code,{children:"window.statsig"})]})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-html",children:'<script type="text/javascript">\n/* dataLayer helper */\n(function(){\nvar f=/\\[object (Boolean|Number|String|Function|Array|Date|RegExp|Arguments)\\]/;function g(a){return null==a?String(a):(a=f.exec(Object.prototype.toString.call(Object(a))))?a[1].toLowerCase():"object"}function m(a,b){return Object.prototype.hasOwnProperty.call(Object(a),b)}function n(a){if(!a||"object"!=g(a)||a.nodeType||a==a.window)return!1;try{if(a.constructor&&!m(a,"constructor")&&!m(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}for(var b in a);return void 0===b||m(a,b)};function p(a,b){var c={},d=c;a=a.split(".");for(var e=0;e<a.length-1;e++)d=d[a[e]]={};d[a[a.length-1]]=b;return c}function q(a,b){var c=!a._clear,d;for(d in a)if(m(a,d)){var e=a[d];"array"===g(e)&&c?("array"===g(b[d])||(b[d]=[]),q(e,b[d])):n(e)&&c?(n(b[d])||(b[d]={}),q(e,b[d])):b[d]=e}delete b._clear};\nfunction r(a,b,c){b=void 0===b?{}:b;"function"===typeof b?b={listener:b,listenToPast:void 0===c?!1:c,processNow:!0,commandProcessors:{}}:b={listener:b.listener||function(){},listenToPast:b.listenToPast||!1,processNow:void 0===b.processNow?!0:b.processNow,commandProcessors:b.commandProcessors||{}};this.a=a;this.l=b.listener;this.j=b.listenToPast;this.g=this.i=!1;this.c={};this.f=[];this.b=b.commandProcessors;this.h=u(this);var d=this.a.push,e=this;this.a.push=function(){var k=[].slice.call(arguments,\n0),l=d.apply(e.a,k);v(e,k);return l};b.processNow&&this.process()}r.prototype.process=function(){this.registerProcessor("set",function(){var c={};1===arguments.length&&"object"===g(arguments[0])?c=arguments[0]:2===arguments.length&&"string"===g(arguments[0])&&(c=p(arguments[0],arguments[1]));return c});this.i=!0;for(var a=this.a.length,b=0;b<a;b++)v(this,[this.a[b]],!this.j)};r.prototype.get=function(a){var b=this.c;a=a.split(".");for(var c=0;c<a.length;c++){if(void 0===b[a[c]])return;b=b[a[c]]}return b};\nr.prototype.flatten=function(){this.a.splice(0,this.a.length);this.a[0]={};q(this.c,this.a[0])};r.prototype.registerProcessor=function(a,b){a in this.b||(this.b[a]=[]);this.b[a].push(b)};\nfunction v(a,b,c){c=void 0===c?!1:c;if(a.i&&(a.f.push.apply(a.f,b),!a.g))for(;0<a.f.length;){b=a.f.shift();if("array"===g(b))a:{var d=a.c;g(b[0]);for(var e=b[0].split("."),k=e.pop(),l=b.slice(1),h=0;h<e.length;h++){if(void 0===d[e[h]])break a;d=d[e[h]]}try{d[k].apply(d,l)}catch(w){}}else if("arguments"===g(b)){e=a;k=[];l=b[0];if(e.b[l])for(d=e.b[l].length,h=0;h<d;h++)k.push(e.b[l][h].apply(e.h,[].slice.call(b,1)));a.f.push.apply(a.f,k)}else if("function"==typeof b)try{b.call(a.h)}catch(w){}else if(n(b))for(var t in b)q(p(t,\nb[t]),a.c);else continue;c||(a.g=!0,a.l(a.c,b),a.g=!1)}}r.prototype.registerProcessor=r.prototype.registerProcessor;r.prototype.flatten=r.prototype.flatten;r.prototype.get=r.prototype.get;r.prototype.process=r.prototype.process;window.DataLayerHelper=r;function u(a){return{set:function(b,c){q(p(b,c),a.c)},get:function(b){return a.get(b)}}};})(); \n\nwindow.StatsigLogger = (function () {\n\n  var statsigInstance;\n  var log = function () {\n    if (typeof localStorage !== \'undefined\' && typeof console !== \'undefined\' && localStorage.getItem(\'debug_ss_gtm\')) {\n      console.log.apply(console, arguments);\n    }\n  };\n\n  var handleGTMMessage = function (model, message) {    \n    if (typeof message === \'object\' && typeof message.event === \'string\') {\n      var metadata = {};\n      for (var prop in message) {\n          if(!(message[prop] instanceof HTMLElement) && typeof(message[prop]) !== \'object\') {\n            metadata[prop] = message[prop];\n          }\n      }\n      log(\'++ handleGTMMessage\', message.event, message.conversionValue || null, metadata);\n      statsigInstance.logEvent(message.event, message.conversionValue || null, metadata);\n    }\n    else {\n      log(\'++ handleGTMMessage / skip\');\n    }\n  }\n  \n  var init = function(condition) {\n    log(\'+++ Statsig:ready ->\', condition);\n    // this may have past messages that haven\'t yet been handled\n    var globalGTMListener = new DataLayerHelper(dataLayer, {\n      listener: handleGTMMessage,\n      listenToPast: true,\n    });        \n  }\n\n  var clientReady = false;\n  try {\n    // The code below assumes that the statsig client lives at `window.statsig`\n    clientReady = (statsig && statsig.getClientX && statsig.getClientX().ready) || statsig.loadingStatus === \'Ready\';\n  } catch(err) { }\n  \n  if(clientReady) {\n    // if client is already initialized, proceed\n    statsigInstance = statsig;\n    init(\'pre-GTM\');\n  }\n  else {\n    // otherwise wait for statsig\n    window.addEventListener(\'statsig:ready\', function(evt) {\n      statsigInstance = evt.detail.statsig;\n      init(\'post-GTM\');\n    });  \n  }\n\n})();  \n<\/script>\n'})}),"\n",(0,a.jsx)(e.h2,{id:"outbound-integration-gtm-data-is-enriched-with-statsig-test-assignments",children:"Outbound Integration (GTM Data is enriched with Statsig test assignments)"}),"\n",(0,a.jsxs)(e.p,{children:["This pattern will allow you to enrich your GTM ",(0,a.jsx)(e.code,{children:"dataLayer"})," with experiment assignment information."]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{alt:"gtm datalayer outbound",src:n(2607).A+"",width:"1058",height:"372"})}),"\n",(0,a.jsxs)(e.p,{children:["Prior to your Statsig ",(0,a.jsx)(e.code,{children:"initialize"})," call, you should bind an EventEmitter listener that captures the assigned experiment name and test group, and push it into the ",(0,a.jsx)(e.code,{children:"dataLayer"})," as follows. Note that the argument passed to the callback contains rich context about the assignment. Please modify the GTM ",(0,a.jsx)(e.code,{children:"dataLayer"})," properties to your liking."]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-js",children:"// use event emitter to listen for experiment assignments\nstatsigClient.on(\"experiment_evaluation\", function(evt) {\n  window.dataLayer.push({\n    'event': 'experiment_viewed',\n    'experiment_name': evt.experiment.name, \n    'variant_name': evt.experiment.groupName\n  })\n});\n\nawait statsigClient.initializeAsync(); \n"})})]})}function d(t={}){const{wrapper:e}={...(0,s.R)(),...t.components};return e?(0,a.jsx)(e,{...t,children:(0,a.jsx)(l,{...t})}):l(t)}},32805:(t,e,n)=>{n.d(e,{A:()=>a});const a=n.p+"assets/images/gtm-create-tag-options-d6c0eebd82c2ea40f63949cd8bffb3c5.png"},18376:(t,e,n)=>{n.d(e,{A:()=>a});const a=n.p+"assets/images/gtm-create-tag-b56405a1612dd8aabc45ff2ed042d30a.png"},12509:(t,e,n)=>{n.d(e,{A:()=>a});const a=n.p+"assets/images/gtm-logstream-a21df5b13f3064e1b1107bd9155b54a2.png"},2607:(t,e,n)=>{n.d(e,{A:()=>a});const a=n.p+"assets/images/gtm-outbound-327a36f678298c223417be8cbd0a2af8.png"},63694:(t,e,n)=>{n.d(e,{A:()=>a});const a=n.p+"assets/images/gtm-tag-configuration-56bedc69b70d1c042dbb0556b7e76ba1.png"},11864:(t,e,n)=>{n.d(e,{A:()=>a});const a=n.p+"assets/images/gtm-tag-trigger-58c3c4e17bfb5bd5100d33dcd97d232a.png"},28453:(t,e,n)=>{n.d(e,{R:()=>o,x:()=>r});var a=n(96540);const s={},i=a.createContext(s);function o(t){const e=a.useContext(i);return a.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function r(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:o(t.components),a.createElement(i.Provider,{value:e},t.children)}}}]);