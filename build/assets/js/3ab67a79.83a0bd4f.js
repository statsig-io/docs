"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[41975],{81532:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var i=n(74848),o=n(28453);const r={title:"Ratio Metrics",sidebar_label:"Ratio",keywords:["owner:vm"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},s=void 0,a={id:"statsig-warehouse-native/metrics/ratio",title:"Ratio Metrics",description:"Summary",source:"@site/docs/statsig-warehouse-native/metrics/ratio.md",sourceDirName:"statsig-warehouse-native/metrics",slug:"/statsig-warehouse-native/metrics/ratio",permalink:"/statsig-warehouse-native/metrics/ratio",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/statsig-warehouse-native/metrics/ratio.md",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{title:"Ratio Metrics",sidebar_label:"Ratio",keywords:["owner:vm"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"warehouse",previous:{title:"Mean",permalink:"/statsig-warehouse-native/metrics/mean"},next:{title:"Funnel++",permalink:"/statsig-warehouse-native/metrics/funnel"}},l={},d=[{value:"Summary",id:"summary",level:2},{value:"Use Cases",id:"use-cases",level:3},{value:"Calculation",id:"calculation",level:2},{value:"Methodology Notes",id:"methodology-notes",level:3},{value:"Options",id:"options",level:2}];function u(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(t.p,{children:"Ratio metrics measure the ratio of two metrics (Count, Sum, Count Distinct, or Unit Count)."}),"\n",(0,i.jsx)(t.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsx)(t.p,{children:"Ratio metrics are used to add a more nuanced understanding - revenue went up, as did purchase volume, but did revenue/purchase go up in a way that was meaningful?"}),"\n",(0,i.jsx)(t.p,{children:"Ratio metrics are also used to normalize metrics. For example, if you're a company that rents out devices like scooters, you might run a scooter-level experiment but want to measure average revenue per distinct rider. You could make a metric of SUM(revenue)/COUNT_DISTINCT(rider_id) to calculate this normalized metric and have the metric be less influenced by scooters in popular areas which get lots of riders."}),"\n",(0,i.jsx)(t.h2,{id:"calculation",children:"Calculation"}),"\n",(0,i.jsx)(t.p,{children:"At the unit level, ratio metrics will calculate both component metric's unit level aggregation."}),"\n",(0,i.jsx)(t.p,{children:"At the group level, the mean is calculated as the total group calculation of the first metric, divided by the total group value of the second metric."}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["The denominator is ",(0,i.jsx)(t.strong,{children:"not"})," the number of units in the experiment; the normalization is by the denominator metric."]})}),"\n",(0,i.jsx)(t.p,{children:"This would look like the SQL below:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'-- Denominator (Checkouts)\nSELECT\n  source_data.unit_id,\n  exposure_data.group_id,\n  COUNT(1) as denominator\nFROM source_data\nJOIN exposure_data\nON\n  -- Only include users who saw the experiment\n  source_data.unit_id = exposure_data.unit_id\n  -- Only include data from after the user saw the experiment\n  -- In this case exposure_data is already deduped to the "first exposure"\n  AND source_data.timestamp >= exposure_data.timestamp\nGROUP BY\n  source_data.unit_id,\n  exposure_data.group_id;\n\n-- Numerator (Revenue)\nSELECT\n  unit_id,\n  group_id,\n  SUM(revenue) as numerator\nFROM source_data\nGROUP BY unit_id, group_id;\n\n-- Group Level\nSELECT\n  group_id,\n  SUM(numerator)/SUM(denominator) as mean\nFROM denominator\n-- full outer join depending on settings\nLEFT JOIN numerator\nUSING (group_id)\nGROUP BY group_id;\n'})}),"\n",(0,i.jsx)(t.h3,{id:"methodology-notes",children:"Methodology Notes"}),"\n",(0,i.jsx)(t.p,{children:"Ratio metrics require adjustment due to potential unit-level covariance between the numerator and the denominator. Statsig uses the delta method to estimate this adjustment."}),"\n",(0,i.jsx)(t.p,{children:"By default, Statsig treats ratio metrics as a conversion rate (unordered). That is, we only count numerator events for units that also performed the denominator event. This is configurable in Advanced settings, where you can switch to a simple ratio."}),"\n",(0,i.jsx)(t.h2,{id:"options",children:"Options"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Treat as conversion rate (unordered).","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Control whether to include numerator events only if the unit also performed the denominator event, regardless of order. Uncheck for a simple ratio, which counts numerator events for all units, even if they never performed the denominator event."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/statsig-warehouse-native/features/cohort-metrics",children:"Cohort Windows"})," (Numerator and Denominator)","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["You can specify a window for data collection after a unit's exposure. For example, a 0-1 day cohort window would only count actions from days 0 and 1 after a unit was exposed to an experiment","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Only include units with a completed window"})," can be selected to remove units out of pulse analysis for this metric until the cohort window has completed"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["Winsorization","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Specify a lower and/or upper percentile bound to winsorize at. Winsorization and its thresholds can be specified for both the numerator and denominator of the ratio metric independently. All values below the lower threshold, or above the upper threshold, will be clamped to that threshold to reduce the outsized impact of outliers on your analysis"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/statsig-warehouse-native/features/cohort-metrics",children:"Baked Metrics"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/statsig-warehouse-native/features/cohort-metrics",children:"Baked Metrics"})," allow you to specify how long a metric needs to mature. This is common in situations like chargebacks or cancellations. Statsig will delay loading the data until the window has elapsed, and only calculate pulse results for that metric if a unit's metric has matured."]}),"\n"]}),"\n"]}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var i=n(96540);const o={},r=i.createContext(o);function s(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);