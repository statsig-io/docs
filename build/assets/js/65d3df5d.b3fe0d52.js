"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[32342],{61898:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var t=s(74848),n=s(28453);const r={title:"Cluster Experiments - Running Analysis Across Unit Types",sidebar_label:"Cluster Experiments",slug:"/metrics/different-id",keywords:["owner:vm"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},o="Analysis When the Unit of Assignment and the Unit of Analysis Are Different",a={id:"metrics/different-id",title:"Cluster Experiments - Running Analysis Across Unit Types",description:"There are two common scenarios where the experiment assignment unit differs from the analysis unit:",source:"@site/docs/metrics/different-id.md",sourceDirName:"metrics",slug:"/metrics/different-id",permalink:"/metrics/different-id",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/metrics/different-id.md",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{title:"Cluster Experiments - Running Analysis Across Unit Types",sidebar_label:"Cluster Experiments",slug:"/metrics/different-id",keywords:["owner:vm"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"warehouse",previous:{title:"A/A Test",permalink:"/statsig-warehouse-native/guides/AATest"},next:{title:"Running Email Experiments",permalink:"/statsig-warehouse-native/guides/email-experiments"}},d={},c=[{value:"Example: Organizations and Users",id:"example-organizations-and-users",level:2},{value:"1. Setup the metric source with <code>org_id</code> as an ID type.",id:"1-setup-the-metric-source-with-org_id-as-an-id-type",level:3},{value:"2. Choose your assignment source, where the unit of assignment is <code>org_id</code>.",id:"2-choose-your-assignment-source-where-the-unit-of-assignment-is-org_id",level:3},{value:"3. Define your metric of revenue per <code>user_id</code>.",id:"3-define-your-metric-of-revenue-per-user_id",level:3},{value:"4. Set up the experiment with <code>org_id</code>",id:"4-set-up-the-experiment-with-org_id",level:3},{value:"Statistics in the backend",id:"statistics-in-the-backend",level:2}];function l(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",ul:"ul",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"analysis-when-the-unit-of-assignment-and-the-unit-of-analysis-are-different",children:"Analysis When the Unit of Assignment and the Unit of Analysis Are Different"})}),"\n",(0,t.jsx)(i.p,{children:"There are two common scenarios where the experiment assignment unit differs from the analysis unit:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsx)(i.li,{children:"Measuring session-level metrics for a user-level experiment. Ratio metrics are commonly used to solve this (this doc)."}),"\n",(0,t.jsxs)(i.li,{children:["Measuring logged-in metrics (eg. revenue) on a logged-out experiment. There are two solutions:\na. Running the experiment at the ",(0,t.jsx)(i.a,{href:"/guides/first-device-level-experiment",children:"device-level"}),", with device-level metrics collected even after the user is logged-in.\nb. Using ",(0,t.jsx)(i.a,{href:"/statsig-warehouse-native/features/id-resolution",children:"ID resolution"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"We will explain how to set up the first scenario with Warehouse Native in this doc."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://github.com/statsig-io/docs/assets/139815787/0b75615f-2b66-44f4-b6e0-e0bd3e555199",alt:"Screenshot 2024-04-29 at 3 45 28\u202fPM"})}),"\n",(0,t.jsx)(i.h2,{id:"example-organizations-and-users",children:"Example: Organizations and Users"}),"\n",(0,t.jsx)(i.p,{children:"Scenario:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Your metrics source has both ",(0,t.jsx)(i.code,{children:"org_id"})," and ",(0,t.jsx)(i.code,{children:"user_id"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:["The relationship between ",(0,t.jsx)(i.code,{children:"org_id"})," and ",(0,t.jsx)(i.code,{children:"user_id"})," is 1-to-many. A single ",(0,t.jsx)(i.code,{children:"org_id"})," can be associated with multiple users (",(0,t.jsx)(i.code,{children:"user_id"}),"), but a ",(0,t.jsx)(i.code,{children:"user_id"})," is only associated with a single ",(0,t.jsx)(i.code,{children:"org_id"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:["Your experiment is assigned at the ",(0,t.jsx)(i.code,{children:"org_id"})," level."]}),"\n",(0,t.jsxs)(i.li,{children:["You are interested in understanding the treatment effect at the ",(0,t.jsx)(i.code,{children:"user_id"})," level, such as revenue per user."]}),"\n"]}),"\n",(0,t.jsxs)(i.h3,{id:"1-setup-the-metric-source-with-org_id-as-an-id-type",children:["1. Setup the metric source with ",(0,t.jsx)(i.code,{children:"org_id"})," as an ID type."]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["In this table, each row of data should have both ",(0,t.jsx)(i.code,{children:"org_id"})," and ",(0,t.jsx)(i.code,{children:"user_id"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://github.com/statsig-io/docs/assets/139815787/a99a4577-8be5-4001-ac4d-2297f3b2fff0",alt:"1 metric source"})}),"\n",(0,t.jsxs)(i.h3,{id:"2-choose-your-assignment-source-where-the-unit-of-assignment-is-org_id",children:["2. Choose your assignment source, where the unit of assignment is ",(0,t.jsx)(i.code,{children:"org_id"}),"."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://github.com/statsig-io/docs/assets/139815787/16472cd7-1aa1-44a2-9a6b-0f789ac5308e",alt:"2 assignment"})}),"\n",(0,t.jsxs)(i.h3,{id:"3-define-your-metric-of-revenue-per-user_id",children:["3. Define your metric of revenue per ",(0,t.jsx)(i.code,{children:"user_id"}),"."]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Your denominator should be ",(0,t.jsx)(i.code,{children:"count distinct user_id"})," instead of ",(0,t.jsx)(i.code,{children:"unit count"}),", because the latter is equivalent to ",(0,t.jsx)(i.code,{children:"count distinct org_id"})," in an ",(0,t.jsx)(i.code,{children:"org_id"})," level experiment."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://github.com/statsig-io/docs/assets/139815787/ca4c9076-28e1-4cf8-8aa1-2127def7d771",alt:"3a right"})}),"\n",(0,t.jsxs)(i.h3,{id:"4-set-up-the-experiment-with-org_id",children:["4. Set up the experiment with ",(0,t.jsx)(i.code,{children:"org_id"})]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://github.com/statsig-io/docs/assets/139815787/02f9c6bb-0b32-4caf-a529-5bacc2a56d44",alt:"4 experiment"})}),"\n",(0,t.jsx)(i.h2,{id:"statistics-in-the-backend",children:"Statistics in the backend"}),"\n",(0,t.jsx)(i.p,{children:"In the Stats Engine, we utilize the delta method to calculate variance and confidence intervals."}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"For mean metrics, we record a value indicating the number of observations per exposed unit in the records column of the staging data. This acts as the denominator or cluster-size value for delta calculations."}),"\n",(0,t.jsx)(i.li,{children:"For general ratio metrics, we monitor the two-component metrics (the ratio and the denominator) as independent metrics and combine them during the pulse analysis to derive a single metric from them."}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["For more information on how we apply the delta method, visit: ",(0,t.jsx)(i.a,{href:"/stats-engine/methodologies/delta-method",children:"Statsig - Delta Method Methodology."}),". The reason we choose to use the delta method is to account for the covariance between the numerator and the denominator (i.e. more users per org is correlated with more revenue). See section 3 of ",(0,t.jsx)(i.a,{href:"https://alexdeng.github.io/public/files/kdd2018-dm.pdf",children:"this paper"})," for details."]}),"\n",(0,t.jsx)(i.p,{children:"This approach is also relevant for analyzing event-level outcomes, such as average purchase value, where randomization occurs at the user level, and each user may experience multiple session events."})]})}function h(e={}){const{wrapper:i}={...(0,n.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,i,s)=>{s.d(i,{R:()=>o,x:()=>a});var t=s(96540);const n={},r=t.createContext(n);function o(e){const i=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),t.createElement(r.Provider,{value:i},e.children)}}}]);