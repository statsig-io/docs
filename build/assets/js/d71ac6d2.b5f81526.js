"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[94635],{54703:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var n=s(74848),i=s(28453);const a={title:"Snowflake (Deprecated)",slug:"snowflake",keywords:["owner:tim"],last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},r=void 0,o={id:"integrations/data-imports/snowflake-deprecated",title:"Snowflake (Deprecated)",description:"This solution is still functional, but can be manual and time consuming to set up with minimal error handling. We encourage you to check out the Data Warehouse Ingestion solution instead.",source:"@site/docs/integrations/data-imports/snowflake-deprecated.md",sourceDirName:"integrations/data-imports",slug:"/integrations/data-imports/snowflake",permalink:"/integrations/data-imports/snowflake",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/integrations/data-imports/snowflake-deprecated.md",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{title:"Snowflake (Deprecated)",slug:"snowflake",keywords:["owner:tim"],last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"cloud",previous:{title:"Redshift (Deprecated)",permalink:"/integrations/data-imports/redshift"},next:{title:"Azure Metrics Upload (Deprecated)",permalink:"/integrations/data-imports/azure-upload"}},d={},l=[{value:"Overview",id:"overview",level:2},{value:"Using a Data Connector",id:"using-a-data-connector",level:2},{value:"Direct ingestion from Snowflake",id:"direct-ingestion-from-snowflake",level:2},{value:"1. Set up your Snowflake data warehouse and user for Statsig integration",id:"setup",level:3},{value:"2. Provide the credentials to Statsig",id:"provide-credentials",level:3},{value:"3. Load data into the new Statsig tables",id:"load-data",level:3},{value:"Events (statsig_events)",id:"events-statsig_events",level:4},{value:"Metrics (statsig_user_metrics)",id:"metrics-statsig_user_metrics",level:4},{value:"Note on metric values",id:"note-on-metric-values",level:5},{value:"Scheduling",id:"scheduling",level:4},{value:"Checklist",id:"checklist",level:4}];function c(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["This solution is still functional, but can be manual and time consuming to set up with minimal error handling. We encourage you to check out the ",(0,n.jsx)(t.a,{href:"/data-warehouse-ingestion/introduction",children:"Data Warehouse Ingestion"})," solution instead."]})}),"\n",(0,n.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsx)(t.p,{children:"There are 2 ways to integrate with Snowflake: using a data connector, or through direct ingestion from Snowflake."}),"\n",(0,n.jsx)(t.h2,{id:"using-a-data-connector",children:"Using a Data Connector"}),"\n",(0,n.jsxs)(t.p,{children:["To ",(0,n.jsx)(t.strong,{children:"ingest"})," events from Snowflake, you can use our ",(0,n.jsx)(t.a,{href:"/integrations/data-connectors/census",children:"Census integration"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["To ",(0,n.jsx)(t.strong,{children:"export"})," events to Snowflake, you can use our ",(0,n.jsx)(t.a,{href:"/integrations/data-connectors/fivetran",children:"Fivetran integration"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"direct-ingestion-from-snowflake",children:"Direct ingestion from Snowflake"}),"\n",(0,n.jsxs)(t.p,{children:["We also support direct data ingestion from Snowflake, through which Statsig will automatically pull data from Snowflake into your events.\nYou will need to do the following steps. Please follow the ",(0,n.jsx)(t.a,{href:"#checklist",children:"checklist"})," to avoid delays!"]}),"\n",(0,n.jsx)(t.h3,{id:"setup",children:"1. Set up your Snowflake data warehouse and user for Statsig integration"}),"\n",(0,n.jsxs)(t.p,{children:["Insert ",(0,n.jsx)(t.code,{children:"USER"})," and ",(0,n.jsx)(t.code,{children:"PASSWORD"})," values to the below and run it in a Snowflake worksheet\non an account which has sysadmin and securityadmin roles."]}),"\n",(0,n.jsx)(t.p,{children:"This will create the table schemas and setup that Statsig's ingestion will use.\nStatsig will use the user you create to access tables in the new Statsig schema. Make sure to use a unique and secure username and password and replace the placeholder values in the first 2 statements."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"BEGIN;\n\n  -- set up variable values to be used in statements later\n  -- make sure to configure user_name and user_password with your own values\n  SET user_name = '<USER>'; -- REPLACE WITH YOUR OWN VALUE\n  SET user_password = '<PASSWORD>'; -- REPLACE WITH YOUR OWN VALUE\n  SET role_name = 'STATSIG_ROLE';\n\n  -- change role to sysadmin for warehouse / database steps\n  USE ROLE sysadmin;\n\n  -- create a warehouse, database, schema and tables for Statsig\n  CREATE OR REPLACE WAREHOUSE statsig WITH warehouse_size='XSMALL';\n  CREATE DATABASE IF NOT EXISTS statsig;\n  CREATE SCHEMA IF NOT EXISTS statsig.statsig;\n\n  -- a table for ingestion of raw events\n  CREATE TABLE IF NOT EXISTS statsig.statsig.statsig_events(\n      time BIGINT NOT NULL, -- unix time\n      timeuuid STRING NOT NULL DEFAULT UUID_STRING(), --generated unique timeuuid\n      user STRING NOT NULL, --json user object\n      event_name STRING NOT NULL,\n      event_value STRING,\n      event_metadata STRING NOT NULL, --json metadata object\n      event_version BIGINT,\n      record_number NUMBER AUTOINCREMENT START 1 INCREMENT 1\n  );\n\n  -- a table for ingestion of metrics/user outcomes\n  CREATE TABLE IF NOT EXISTS statsig.statsig.statsig_user_metrics(\n      unit_id STRING NOT NULL,\n      id_type STRING NOT NULL, -- stable_id, user_id, etc.\n      date DATE NOT NULL, -- YYYY-MM-DD. Statsig calculates dates according to PST\n      timeuuid STRING NOT NULL DEFAULT UUID_STRING(),\n      metric_name STRING NOT NULL,\n      metric_value NUMBER,\n      numerator NUMBER,\n      denominator NUMBER\n  );\n\n  CREATE TABLE IF NOT EXISTS statsig.statsig.statsig_events_signal(\n      finished_date DATE\n  );\n\n  CREATE TABLE IF NOT EXISTS statsig.statsig.statsig_user_metrics_signal(\n      finished_date DATE\n  );\n\n  -- change current role to securityadmin to create role and user for Statsig's access\n  USE ROLE securityadmin;\n\n  -- create role for Statsig\n  CREATE ROLE IF NOT EXISTS identifier($role_name);\n  GRANT ROLE identifier($role_name) TO ROLE SYSADMIN;\n\n  -- create a user for Statsig\n  CREATE USER IF NOT EXISTS identifier($user_name)\n  password = $user_password\n  default_role = $role_name\n  default_warehouse = statsig;\n  GRANT ROLE identifier($role_name) TO USER identifier($user_name);\n\n  -- grant Statsig role access\n  GRANT USAGE ON WAREHOUSE statsig TO ROLE identifier($role_name);\n  GRANT USAGE ON DATABASE statsig TO ROLE identifier($role_name);\n  GRANT USAGE ON SCHEMA statsig.statsig TO ROLE identifier($role_name);\n  GRANT SELECT ON statsig.statsig.statsig_events TO ROLE identifier($role_name);\n  GRANT SELECT ON statsig.statsig.statsig_user_metrics TO ROLE identifier($role_name);\n  GRANT SELECT ON statsig.statsig.statsig_events_signal TO ROLE identifier($role_name);\n  GRANT SELECT ON statsig.statsig.statsig_user_metrics_signal TO ROLE identifier($role_name);\n\nCOMMIT;\n"})}),"\n",(0,n.jsx)(t.p,{children:"Make sure all the statements ran successfully. This will create the schema and user that Statsig's ingestion expects."}),"\n",(0,n.jsx)(t.h3,{id:"provide-credentials",children:"2. Provide the credentials to Statsig"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Go to ",(0,n.jsx)(t.a,{href:"https://console.statsig.com/",children:"console.statsig.com"})," and log in"]}),"\n",(0,n.jsx)(t.li,{children:"Go to the settings page and navigate to the integrations tab."}),"\n",(0,n.jsx)(t.li,{children:"Find Snowflake in the integrations list and provide the requested credentials for the user you just created in step 1."}),"\n",(0,n.jsx)(t.li,{children:'You can use the "Test Connection" button to make sure we can establish a connection to the table using the credentials provided.'}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:"https://user-images.githubusercontent.com/77478330/162287996-5f2e02f8-c461-4d69-8a36-fa1d79d913a3.png",alt:"Snowflake integration configuration interface"})}),"\n",(0,n.jsx)(t.h3,{id:"load-data",children:"3. Load data into the new Statsig tables"}),"\n",(0,n.jsx)(t.p,{children:"In step 1 we created 2 data tables and 2 signal tables. To load data into statsig, you\nwill load data into the data tables, and mark a day as completed in the corresponding signal\ntable once all of the data for that day is loaded."}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"statsig_events"})," table is for sending Statsig raw events which were not logged to Statsig through the API. Once loaded,\nthese events will be processed as though they were logged directly."]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"statsig_user_metrics"})," table is for sending pre-computed metrics from your data warehouse. These metrics will be surfaced in\nthe statsig console and in your test results."]}),"\n",(0,n.jsx)(t.p,{children:"You may only need one of these use cases - that's fine! Just follow the steps for the relevant table and ignore the other one."}),"\n",(0,n.jsx)(t.p,{children:"Your data should conform to these definitions and rules to avoid errors or delays:"}),"\n",(0,n.jsx)(t.h4,{id:"events-statsig_events",children:"Events (statsig_events)"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Column"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Rules"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"time"}),(0,n.jsx)(t.td,{children:"The unix time your event was logged at"}),(0,n.jsx)(t.td,{children:"Not null"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"timeuuid"}),(0,n.jsx)(t.td,{children:"A unique timeuuid for the event"}),(0,n.jsx)(t.td,{children:"This should be a timeuuid, but using a unique id will suffice. If not provided, the table defaults to generating a UUID."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"user"}),(0,n.jsx)(t.td,{children:"A user json object."}),(0,n.jsx)(t.td,{children:"See below"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"event_name"}),(0,n.jsx)(t.td,{children:"The name of the event"}),(0,n.jsx)(t.td,{children:"Not null. Length < 128 characters"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"event_value"}),(0,n.jsx)(t.td,{children:"The value of the event"}),(0,n.jsx)(t.td,{children:"Length < 128 characters"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"event_metadata"}),(0,n.jsx)(t.td,{children:"Metadata about the event"}),(0,n.jsx)(t.td,{children:"Not null. Length < 16384 characters. Json-formatted - leave empty if none"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"event_version"}),(0,n.jsx)(t.td,{children:"The version of this event"}),(0,n.jsx)(t.td,{})]})]})]}),"\n",(0,n.jsx)(t.p,{children:"The user object is a stringified JSON representation. An example might look like:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-json",children:'{\n  "os": "Mac OS X",\n  "os_version": "10.15.7",\n  "browser_name": "Electron",\n  "browser_version": "11.5.0",\n  "ip": "1.1.1.1",\n  "country": "KR",\n  "locale": "en-US",\n  "userID": "bbbbb-bbbbb-bbbbb-bbbbb",\n  "custom": {\n    "locale": "en-US",\n    "clientVersion": "23.10.23.10",\n    "desktopVersion": "11.5.0"\n  },\n  "customIDs": {\n    "deviceId": "ddddd-ddddd-ddddd-ddddd",\n    "stableID": "sssss-sssss-sssss-sssss"\n  }\n}\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Key components of the user object are the ",(0,n.jsx)(t.code,{children:"userID"}),", ",(0,n.jsx)(t.code,{children:"custom"})," fields, and the ",(0,n.jsx)(t.code,{children:"customIDs"})," object (notably ",(0,n.jsx)(t.code,{children:"stableID"}),") if you are using any custom identifiers."]}),"\n",(0,n.jsx)(t.p,{children:"Make sure these fields are provided where they exist, and that the names of the fields capitalized correctly. Not providing a\nunit identifier will limit the utility of your events, as we won't be able to use them to build metrics like daily event users."}),"\n",(0,n.jsx)(t.h4,{id:"metrics-statsig_user_metrics",children:"Metrics (statsig_user_metrics)"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Column"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Rules"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"unit_id"}),(0,n.jsx)(t.td,{children:"The unique user identifier this metric is for. This might not necessarily be a user_id - it could be a custom_id of some kind"}),(0,n.jsx)(t.td,{})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"id_type"}),(0,n.jsx)(t.td,{children:"The id_type the unit_id represents."}),(0,n.jsx)(t.td,{children:"Must be a valid id_type. The default Statsig types are user_id/stable_id, but you may have generated custom id_types"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"date"}),(0,n.jsx)(t.td,{children:"Date of the daily metric"}),(0,n.jsx)(t.td,{})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"timeuuid"}),(0,n.jsx)(t.td,{children:"A unique timeuuid for the event"}),(0,n.jsx)(t.td,{children:"This should be a timeuuid, but using a unique id will suffice. If not provided, the table defaults to generating a UUID."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"metric_name"}),(0,n.jsx)(t.td,{children:"The name of the metric"}),(0,n.jsx)(t.td,{children:"Not null. Length < 128 characters"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"metric_value"}),(0,n.jsx)(t.td,{children:"A numeric value for the metric"}),(0,n.jsx)(t.td,{children:"Metric value, or both of numerator/denominator need to be provided for Statsig to process the metric. See details below"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"numerator"}),(0,n.jsx)(t.td,{children:"Numerator for metric calculation"}),(0,n.jsx)(t.td,{children:"See above, and details below"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"denominator"}),(0,n.jsx)(t.td,{children:"Denominator for metric calculation"}),(0,n.jsx)(t.td,{children:"See above, and details below"})]})]})]}),"\n",(0,n.jsx)(t.p,{children:"Metric ingestion is for user-day metric pairs. This is useful for measuring experimental results on complex business logic (e.g. LTV estimates) that you generate in your data warehouse."}),"\n",(0,n.jsx)(t.h5,{id:"note-on-metric-values",children:"Note on metric values"}),"\n",(0,n.jsxs)(t.p,{children:["If you provide ",(0,n.jsx)(t.strong,{children:"both"})," a numerator and denominator value for any record of a metric, we'll assume that this metric is a ratio metric; we'll filter out users who do not have a denominator value from analysis, and recalculate the metric value ourselves via the numerator and denominator fields."]}),"\n",(0,n.jsx)(t.p,{children:"If you only provide a metric_value, we'll use the metric_value for analysis. In this case, we'll impute 0 for users without a metric value in experiments."}),"\n",(0,n.jsx)(t.h4,{id:"scheduling",children:"Scheduling"}),"\n",(0,n.jsx)(t.p,{children:"Because you may be streaming events to your tables or have multiple ETLs pointing to your metrics table, Statsig relies on you\nsignalling that your metric/events for a given day are done."}),"\n",(0,n.jsxs)(t.p,{children:["When a day is fully loaded, insert that date as a row in the appropriate signal_table - ",(0,n.jsx)(t.code,{children:"statsig_user_metrics_signal"})," for metrics\nor ",(0,n.jsx)(t.code,{children:"statsig_events_signal"})," for events. For example, once all of your metrics data is loaded into ",(0,n.jsx)(t.code,{children:"statsig_user_metrics"})," for ",(0,n.jsx)(t.code,{children:"2022-04-01"}),", you would insert ",(0,n.jsx)(t.code,{children:"2022-04-01"})," into ",(0,n.jsx)(t.code,{children:"statsig_user_metrics_signal"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["Statsig expects you to load data in order. For example, if you have loaded up to ",(0,n.jsx)(t.code,{children:"2022-04-01"})," and signal that ",(0,n.jsx)(t.code,{children:"2022-04-03"})," has landed,\nwe will wait for you to signal that ",(0,n.jsx)(t.code,{children:"2022-04-02"})," has landed, and load that data before we ingest data from ",(0,n.jsx)(t.code,{children:"2022-04-03"})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"NOTE: this ingestion pipeline is in beta, and does not currently support automatic backfills or updates to data once it's been ingested. Only signal these tables\nare loaded after you've run data quality checks!"})}),"\n",(0,n.jsx)("a",{name:"checklist"}),"\n",(0,n.jsx)(t.h4,{id:"checklist",children:"Checklist"}),"\n",(0,n.jsx)(t.p,{children:"These are common errors we've run into - please go through and make sure your setup is looking good!"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Field names are set incorrectly","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Some of the field names here may intersect with protected key words. You should be able to generate these by wrapping them in quotes if needed. The above SQL works in the snowflake console."}),"\n",(0,n.jsxs)(t.li,{children:["Run ",(0,n.jsx)(t.code,{children:"SELECT *"})," on your tables when done to confirm that there aren't any special characters in the column names! This will cause our ingestion to fail."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["The ",(0,n.jsx)(t.code,{children:"id_type"})," is set correctly","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Default types are ",(0,n.jsx)(t.code,{children:"user_id"})," or ",(0,n.jsx)(t.code,{children:"stable_id"}),". If you have custom ids, make sure that the capitalization and spelling matches as these are case sensitive (you can find your custom ID types by going to your Project Settings in the Statsig console)."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["Your ids match the format of ids logged from SDKs","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["In some cases, your data warehouse may transform IDs. This may mean we can't join your experiment or feature gate data to your metrics to calculate pulse or other reports. You can go to the Metrics page of your project and view the log stream to check the format of the ids being sent (either ",(0,n.jsx)(t.code,{children:"User ID"}),", or a custom ID in ",(0,n.jsx)(t.code,{children:"User Properties"}),") to confirm they match"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"If your data is not showing up in the Statsig console"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Monitoring is limited today, but you should be able to check your snowflake query history for the Statsig user to understand which data is being pulled, and if queries are not executing (no history) or are failing."}),"\n",(0,n.jsx)(t.li,{children:"You should see polling queries within a few hours of setting up your integration."}),"\n",(0,n.jsx)(t.li,{children:"If you have a signal date in the last 28d, you should see a select statement for data from the earliest signal date in that window"}),"\n",(0,n.jsx)(t.li,{children:"If that query fails, try running it yourself to understand if there is a schema issue"}),"\n",(0,n.jsx)(t.li,{children:"If data is loading, it's likely we're just processing. For new metrics, give it a day to catch. If data isn't loaded after a day or two, please check in with us. The most common reason for metrics catalog failures is due to id_type mismatches."}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>o});var n=s(96540);const i={},a=n.createContext(i);function r(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);