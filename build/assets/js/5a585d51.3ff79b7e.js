"use strict";(self.webpackChunkstatsig_docs=self.webpackChunkstatsig_docs||[]).push([[62711],{66100:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var s=i(74848),t=i(28453);const r={slug:"/server/nodejsServerSDK/upgrade_guide/v5ToV6",title:"Node SDK v5.x.x to v6.0.0 Upgrade Guide",keywords:["owner:brock"],displayed_sidebar:"cloud",last_update:{date:new Date("2025-09-18T00:00:00.000Z")}},o=void 0,a={id:"server/node/upgrade_guide/v5ToV6UpgradeGuide",title:"Node SDK v5.x.x to v6.0.0 Upgrade Guide",description:"Summary",source:"@site/docs/server/node/upgrade_guide/v5ToV6UpgradeGuide.mdx",sourceDirName:"server/node/upgrade_guide",slug:"/server/nodejsServerSDK/upgrade_guide/v5ToV6",permalink:"/server/nodejsServerSDK/upgrade_guide/v5ToV6",draft:!1,unlisted:!1,editUrl:"https://github.com/statsig-io/docs/edit/main/docs/server/node/upgrade_guide/v5ToV6UpgradeGuide.mdx",tags:[],version:"current",lastUpdatedAt:17581536e5,frontMatter:{slug:"/server/nodejsServerSDK/upgrade_guide/v5ToV6",title:"Node SDK v5.x.x to v6.0.0 Upgrade Guide",keywords:["owner:brock"],displayed_sidebar:"cloud",last_update:{date:"2025-09-18T00:00:00.000Z"}},sidebar:"cloud"},d={},c=[{value:"Summary",id:"summary",level:3},{value:"Synchronous Core APIs",id:"synchronous-core-apis",level:4},{value:"DataAdapter Cache Key Changes",id:"dataadapter-cache-key-changes",level:4},{value:"Hash Algorithm Change on getClientInitializeResponse()",id:"hash-algorithm-change-on-getclientinitializeresponse",level:4},{value:"Default environment is production if no environment is being set when SDK is initialized",id:"default-environment-is-production-if-no-environment-is-being-set-when-sdk-is-initialized",level:4},{value:"Deprecate functions",id:"deprecate-functions",level:4}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h3,{id:"summary",children:"Summary"}),(0,s.jsx)(n.p,{children:"Node.js SDK V6.0.0 introduced breaking changes on"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#synchronous-core-apis",children:"Removed async version of core APIs (checkGate, getConfig..)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#dataadapter-cache-key-changes",children:"Changed DataAdapter cache keys SDK used to read and write from"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#hash-algorithm-change-on-getclientinitializeresponse",children:"Changed default hashing algorithm used for getClientInitializeResponse() which is being used for bootstrapping client sdk."})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsxs)(n.a,{href:"#default-environment-is-production-if-no-environment-is-being-set-when-sdk-is-initialized",children:["If no environment tier is being set for SDK, we will default environment to be ",(0,s.jsx)(n.code,{children:"production"})," when evaluating."]})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#deprecate-functions",children:"Changed how you should disable exposure logging"})}),"\n"]}),(0,s.jsx)(n.h4,{id:"synchronous-core-apis",children:"Synchronous Core APIs"}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Changes"}),"\nChanged all core apis to be synchronous functions"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// All removed\nasync getFeatureGate(): Promise<FeatureGate> // Removed\ngetFeatureGate(): FeatureGate // New API\n\nasync checkGate(): Promise<bool> // Removed\ncheckGate(): bool // New API\n\nasync getConfig(): Promise<DynamicConfig>\ngetConfig(): DynamicConfig // New API\n\nasync getExperiment(): Promise<DynamicConfig>\ngetExperiment(): DynamicConfig // New API\n....\n\n"})}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Context"}),"\nThe initial design of async APIs are ensuring every evaluation can be done properly even when the SDK is not compatible by requesting evaluation from Statsig Server.\nHowever, as SDK and evaluation rules become more stable, we rarely see such cases. For the performance of core apis, we make all apis synchronous functions."]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Migration Guide"}),"\nIf you are using gate as following way, and you are using ",(0,s.jsx)(n.strong,{children:"javascript runtime error"})," will be reported, please audit and update the usage\nIf you are using typescript, compile error will be reported.\nMeanwhile, we deprecated functions ",(0,s.jsx)(n.code,{children:"*Sync()"})," for example ",(0,s.jsx)(n.code,{children:"checkGateSync()"}),", please use checkGate()"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'Statsig.checkGate(user, "gate").then(() => {\n  // do somethig\n}).catch() // Compile error if you are using typescript. If you are using javascript, there will be runtime error please audit and \n'})}),(0,s.jsx)(n.p,{children:"If you are using as following ways, still recommend to remove await, but there won't affect usage."}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'const gate = await Statsig.checkGate(user, "gate")\n'})}),(0,s.jsx)(n.h4,{id:"dataadapter-cache-key-changes",children:"DataAdapter Cache Key Changes"}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Context"}),"\nTo better support using multiple Statsig Instances in one runtime, and also better support over different responses format, for example download_config_spec_v1 vs download_config_spec_v2 (we are in the process of introducing dcs v2), we updated the cache keys SDK read and write from to avoid cache key collision.\nWe also embedded the compress encoding format we are using, right now we are only storing plain_text no-compressed version within Cache. We plan to support set compressing version for perf improvements."]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Changes"})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Change cache key for config_specs from ",(0,s.jsx)(n.code,{children:"statsig.cache"})," to"]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"statsig|/v1/download_config_specs|{compressEncoding // plain text for now}|{SHA256HashedBase64(secretkey)}"})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Change cache key for get_id_list_sources from ",(0,s.jsx)(n.code,{children:"statsig.id_lists"})," to be:"]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"statsig|/v1/get_id_lists|{compressEncoding // plain text for now}|{SHA256HashedBase64(secretkey)}"})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Change cache key for individual id list to be"}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"statsig|id_list::${String(idListName)}|{compressEncoding // plain text for now}|${SHA256HashedBase64(secretKey)}"})}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Migration Guide"})}),(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"If you are using one of our Edge DataAdapter, please don't upgrade yet, we are adding support for this"})}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Update your DataAdapter if you are customizing the key and get and read logic"}),"\n",(0,s.jsx)(n.li,{children:"If you are writing to cache in other places (instead of relying on SDK setting the cache), update the call-site to use the new key"}),"\n",(0,s.jsx)(n.li,{children:"If you are ok with cache miss with the first request, then you don\u2019t need to do anything, SDK will write to cache with new key."}),"\n",(0,s.jsx)(n.li,{children:"If you don\u2019t want cold cache, please write with the new key before push to production"}),"\n"]}),(0,s.jsx)(n.h4,{id:"hash-algorithm-change-on-getclientinitializeresponse",children:"Hash Algorithm Change on getClientInitializeResponse()"}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Context"}),"\nFor faster evaluation (in both client side and server side) and to reduce payload size, we changed default hash algorithm being used for all config names to be djb2 instead of SHA256."]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Changes"}),"\nConfig (gate / experiment / layers) names are now hashed with djb2 algorithm instead of SHA256 by default. If you are specifying what hash algorithm to use, this should not have affect on you."]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Migration Guide"}),"\nIf you are using latest (or relatively new client sdk), client side should automatically supported, no actions needed from you.\nIf you need SHA256 for specific reasons, set ",(0,s.jsx)(n.code,{children:"ClientInitializeResponseOptions.hash = 'sha256'"})]}),(0,s.jsx)(n.h4,{id:"default-environment-is-production-if-no-environment-is-being-set-when-sdk-is-initialized",children:"Default environment is production if no environment is being set when SDK is initialized"}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Context"}),"\nWe have seen many confusions over environment tier\n",(0,s.jsx)(n.strong,{children:"Changes"}),"\nIf no environment tier is being set, e.g ",(0,s.jsx)(n.code,{children:"StatsigOptions.environment.tier"}),", SDK now has a default value assigned to it. Default value will be your sdk key if it's being set. Otherwise default to production"]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Migration"}),"\nNotes: If you have call-site which does not set environment tier, for rules which have non-production env tier, it will be failing now.\nIt will not affect call-site which has environment tier. Or rules don't set environment or includes production tier."]}),(0,s.jsx)(n.h4,{id:"deprecate-functions",children:"Deprecate functions"}),(0,s.jsx)(n.p,{children:"WithExposureLoggingDisabled functions are deprecated"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"checkGateWithExposureLoggingDisabled()  // DO NOT USE\ngetFeatureGateWithExposureLoggingDisabled() // DO NOT USE\n...\n"})}),(0,s.jsx)(n.p,{children:"use core apis with options instead"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"Statsig.checkGate(user, gate_name, {disableExposureLogging: true})  // Use\nStatsig.getFeatureGate(user, gate_name, {disableExposureLogging: true})  // USE\n...\n"})})]})})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var s=i(96540);const t={},r=s.createContext(t);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);