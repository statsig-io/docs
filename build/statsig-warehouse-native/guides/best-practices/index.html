<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-statsig-warehouse-native/guides/best-practices" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Data Best Practices | Statsig Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.statsig.com/img/docs_meta_q3_2023.png"><meta data-rh="true" name="twitter:image" content="https://docs.statsig.com/img/docs_meta_q3_2023.png"><meta data-rh="true" property="og:url" content="https://docs.statsig.com/statsig-warehouse-native/guides/best-practices"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Best Practices | Statsig Docs"><meta data-rh="true" name="description" content="Best Practices for using Statsig in your warehouse"><meta data-rh="true" property="og:description" content="Best Practices for using Statsig in your warehouse"><meta data-rh="true" name="keywords" content="owner:vm"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://docs.statsig.com/statsig-warehouse-native/guides/best-practices"><link data-rh="true" rel="alternate" href="https://docs.statsig.com/statsig-warehouse-native/guides/best-practices" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.statsig.com/statsig-warehouse-native/guides/best-practices" hreflang="x-default"><script>!function(e,t,n,a){e[a]=e[a]||[],e[a].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var r=t.getElementsByTagName(n)[0],o=t.createElement(n);o.async=!0,o.src="https://www.googletagmanager.com/gtm.js?id=GTM-NRDCWNF";var c=t.querySelector("[nonce]");c&&o.setAttribute("nonce",c.nonce||c.getAttribute("nonce")),r.parentNode.insertBefore(o,r)}(window,document,"script","dataLayer")</script>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=G-EM5RHE1RHW"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EM5RHE1RHW")</script>
<script src="https://www.statsig.com/js/single-id.js" onload="setupStatsigSingleId(&#39;docs&#39;)"></script>
<script src="https://cdn.jsdelivr.net/npm/@statsig/js-client@3/build/statsig-js-client+session-replay+web-analytics.min.js?apikey=client-XlqSMkAavOmrePNeWfD0fo2cWcjxkZ0cJZz64w7bfHX"></script>
<script>window.statsigTier="production"</script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&amp;display=swap">
<script src="/js/rapidoc-min.js"></script>
<script src="https://cdn.koala.live/v1/daniel/sdk.js"></script>
<script src="/js/koala.js"></script>

<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script id="kapa-widget-script" src="https://widget.kapa.ai/kapa-widget.bundle.js" defer="defer" data-website-id="418990dd-0615-4ba7-b52f-3ab8c1af4e79" data-project-name="Statsig" data-project-color="#1963d2" data-project-logo="https://statsig.com/images/sections/multi-products-v2/menu-statsig.svg" data-scale-factor="1.2" data-modal-lock-scroll="false" data-modal-image="https://raw.githubusercontent.com/statsig-io/docs/f263b88116852d7c7174b82df1b528609a1ea073/static/img/favicon.svg" data-button-hide="true" data-modal-override-open-id="ask-ai-navbar-button" data-modal-disclaimer="Statsig Docs AI answers questions using documentations, API references, blogs, and videos. Responses are AI-generated, and we encourage you to rate them to let us know what you think!" data-answer-feedback-info-text="All feedback is reviewed by the Statsig team." data-search-mode-default="true" data-search-mode-enabled="true" data-modal-open-on-command-k="true" data-modal-command-k-search-mode-default="true" data-modal-search-input-placeholder="Search Statsig docs..." data-search-include-source-names="[&quot;Documentation&quot;]" data-search-show-ask-ai-cta="false" data-search-result-link-target="_self" data-modal-full-screen-on-mobile="false" data-kapa-branding-text="Powered by kapa.ai and Statsig" data-question-text-color="#1963d2"></script><link rel="stylesheet" href="/assets/css/styles.1d9de8a2.css">
<script src="/assets/js/runtime~main.deeb172e.js" defer="defer"></script>
<script src="/assets/js/main.54c97fc8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/2025_Statsig_Logo_Black.svg" alt="Statsig" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/2025_Statsig_Logo_White.svg" alt="Statsig" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" sidebarid="product-docs" id="product-docs" href="/">Product Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" id="warehouse" href="/statsig-warehouse-native/introduction">Warehouse Native</a><a class="navbar__item navbar__link" id="sdk-api" href="/sdks/quickstart">SDKs &amp; APIs</a></div><div class="navbar__items navbar__items--right"><button id="ask-ai-navbar-button" class="ask-ai-search-button"><svg class="ask-ai-search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="ask-ai-search-text">Search with Ask AI</span><span class="ask-ai-shortcut"><kbd>Ctrl</kbd><kbd>K</kbd></span></button><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/introduction">About Warehouse Native</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/guides/quick-start">WHN Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/native-vs-cloud">WHN vs Cloud</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/statsig-warehouse-native/guides/running_a_poc">POCs &amp; Evaluations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/statsig-warehouse-native/guides/checklist">Debugging</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/guides/forwarded-data">Forwarded Data</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Warehouse Integrations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/guides/connect">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/connecting-your-warehouse/snowflake">Snowflake</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/connecting-your-warehouse/athena">Athena</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/connecting-your-warehouse/bigquery">BigQuery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/connecting-your-warehouse/databricks">Databricks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/connecting-your-warehouse/redshift">Redshift</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/connecting-your-warehouse/trino">Trino [Beta]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/connecting-your-warehouse/clickhouse">Clickhouse [Beta]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/connecting-your-warehouse/fabric">Fabric [Beta]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/connecting-your-warehouse/other">Other Warehouses</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Warehouse Management</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/data-privacy">Egress, Privacy, &amp; Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/warehouse-management/storage">Warehouse Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/guides/costs">Warehouse Costs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/statsig-warehouse-native/guides/best-practices">Best Practices</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Data &amp; Semantic Layer</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/configuration/data-and-semantic-layer">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/configuration/metric-sources">Metric Sources</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/statsig-warehouse-native/configuration/metrics">Metrics</a><button aria-label="Expand sidebar category &#x27;Metrics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/configuration/metric-examples">Metric Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/features/cohort-metrics">Cohort Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/configuration/dimensional-analysis">Dimension Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/configuration/assignment-sources">Assignment Sources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/configuration/entity-properties">Entity Properties</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/configuration/qualifying-events">Qualifying Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/statsig-warehouse-native/configuration/tags-and-teams">Metric Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/statsig-warehouse-native/configuration/console-api">Programmatic Management</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Experiment Analysis</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/features/understanding-experiments">Understanding Experiments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/features/experiment-options">Configuration</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/statsig-warehouse-native/features/configure-an-experiment">Setup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/statsig-warehouse-native/features/reloads">Loading Results</a><button aria-label="Expand sidebar category &#x27;Loading Results&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/pulse/read-pulse-whn">Interpreting Results</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/statsig-warehouse-native/features/statistics">Statistics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/experiments-plus/cure">CURE</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/experimentation/meta-analysis-whn">Meta-Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/features/autotune">Autotune</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/features/use-case">Practical Use Cases</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Other Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/features/mex-on-warehouse-native">Metrics Explorer on WHN</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/experiments-plus/geotests">Geotests</a><button aria-label="Expand sidebar category &#x27;Geotests&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statsig-warehouse-native/features/other-features">Other Features</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Warehouse Management</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Best Practices</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Data Best Practices</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cost-management">Cost Management<a href="#cost-management" class="hash-link" aria-label="Direct link to Cost Management" title="Direct link to Cost Management">​</a></h2>
<p>Statsig&#x27;s pipelines leverage many SQL best practices in order to reduce cost, and smaller customers can run month-long analyses for a few pennies.</p>
<p>Following these best practices will help keep costs under control and consistent.</p>
<p>Skip ahead to<a href="https://docs.statsig.com/statsig-warehouse-native/guides/best-practices#compute-cost-transparency" target="_blank" rel="noopener noreferrer"> Compute Cost Transparency</a> if you want to see how much compute time you experiments use.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="follow-sql-best-practices">Follow SQL Best Practices<a href="#follow-sql-best-practices" class="hash-link" aria-label="Direct link to Follow SQL Best Practices" title="Direct link to Follow SQL Best Practices">​</a></h3>
<p>Statsig uses your SQL to connect to your source data. Here&#x27;s some common issues:</p>
<ul>
<li>
<p>Avoid using <code>SELECT *</code>, and only select the columns you&#x27;ll need</p>
<ul>
<li><code>SELECT *</code> leads to a lack of clarity in what you are pulling/require for other users</li>
<li>For warehouse like Bigquery and Snowflake, it can increase the scan/size of materialized assets like CTEs in snowflake</li>
<li>This leads to higher query runtime and higher warehouse bills</li>
</ul>
</li>
<li>
<p>Filter to the data you will need in your base query</p>
<ul>
<li>This reduces the scan and amount of data required in future operations</li>
<li>You can use Statsig Macros (below) to dynamically prune date partitions in subqueries</li>
</ul>
</li>
<li>
<p>Group common metric groups into a single Metric Source</p>
<ul>
<li>Statsig will filter your source to the minimal set of data and then create materializations of experiment-tagged data. To maximize the effectiveness of this strategy,
have metric sources that cover common suites of metrics that are usually pulled together.</li>
</ul>
</li>
<li>
<p>Cluster/Partition tables to reduce query scope</p>
<ul>
<li>Most warehouses offer some form of partitioning or indexing along frequently filtered keys. In warehouses with clustering, we recommend the following strategy:<!-- -->
<ul>
<li>Partition/Cluster Assignment Source tables by date, and then your experiment_id column so experiment-level queries can be scoped to just that experiment</li>
<li>Partition/Cluster Metric Source tables based on date, and then the fields you expect to use for filters</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>These best practices are generally true across all warehouses, especially as the datasets you use for experimentation scale.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="materialize-tablesviews">Materialize Tables/Views<a href="#materialize-tablesviews" class="hash-link" aria-label="Direct link to Materialize Tables/Views" title="Direct link to Materialize Tables/Views">​</a></h3>
<p>Since Statsig offers a flexible and robust metric creation flow, it&#x27;s common for people to write joins or other complex queries in a metric source. As tables and experimental velocity scale, these joins can become expensive since they will be run across every experiment analysis.</p>
<p>To reduce the impact of this, best practice is to:</p>
<ul>
<li>Materialize the results of the join and reference that in Statsig, so you only have to compute the join once</li>
<li>Use Statsig macros to make sure partitions are pruned before the join, and you only join the data you need</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-incremental-reloads">Use Incremental Reloads<a href="#use-incremental-reloads" class="hash-link" aria-label="Direct link to Use Incremental Reloads" title="Direct link to Use Incremental Reloads">​</a></h3>
<p>Statsig offers both Full and Incremental reloads. Incremental reloads will only process new data, and can be significantly cheaper on long-running experiments. A number of advanced settings in the pulse advanced settings section (and available at an org-level default) will help you make tradeoffs to reduce the total compute cost. For example &quot;Only calculate the latest day of experiment results&quot; skips timeseries, but can run large full reloads (e.g. 1-year on 100M users) in 5 minutes on a Large snowflake cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reload-data-ad-hoc">Reload Data Ad-Hoc<a href="#reload-data-ad-hoc" class="hash-link" aria-label="Direct link to Reload Data Ad-Hoc" title="Direct link to Reload Data Ad-Hoc">​</a></h3>
<p>Depending on your warehouse and data size, Statsig Pulse results can be available in as little as 45 seconds. Since there&#x27;s flat costs to pipelines, reloading 5 days is not 5 times as expensive as loading one day.</p>
<p>If cost is a high concern, being judicious about which results you schedule vs. load on-demand can significantly reduce the amount of processing your warehouse has to do.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="leverage-statsigs-advanced-options">Leverage Statsig&#x27;s Advanced Options<a href="#leverage-statsigs-advanced-options" class="hash-link" aria-label="Direct link to Leverage Statsig&#x27;s Advanced Options" title="Direct link to Leverage Statsig&#x27;s Advanced Options">​</a></h3>
<p>By default, Statsig runs a thorough analysis including historical timeseries and context on your results.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="utilize-metric-level-reloads">Utilize Metric Level Reloads<a href="#utilize-metric-level-reloads" class="hash-link" aria-label="Direct link to Utilize Metric Level Reloads" title="Direct link to Utilize Metric Level Reloads">​</a></h3>
<p>Statsig offers Metric-level reloads; this allows you to add a new metric to an experiment and get its entire history, or restate a single metric after its definition has changed. This is cheaper than a full reload for experiments with many metrics, and is an easy way to check guardrails or analyze follow-up questions post-hoc.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-statsigs-macros">Use Statsig&#x27;s Macros<a href="#use-statsigs-macros" class="hash-link" aria-label="Direct link to Use Statsig&#x27;s Macros" title="Direct link to Use Statsig&#x27;s Macros">​</a></h3>
<p>In Metric and Assignment sources, you can use Statsig Macros to directly inject a DATE() type which will be relative to the experiment period being loaded.</p>
<ul>
<li><code>{statsig_start_date}</code></li>
<li><code>{statsig_end_date}</code></li>
</ul>
<p>For example, in an incremental reload from <code>2023-09-01</code> to <code>2023-09-03</code>, this query:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM log_table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE dt BETWEEN {statsig_start_date} AND {statsig_end_date}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>resolves to</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM log_table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE dt BETWEEN DATE(&#x27;2023-09-01&#x27;) AND DATE(&#x27;2023-09-03&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a powerful tool since you can inject filters into queries with joins or CTEs and be confident that the initial scan will be pruned.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoid-contention">Avoid Contention<a href="#avoid-contention" class="hash-link" aria-label="Direct link to Avoid Contention" title="Direct link to Avoid Contention">​</a></h3>
<p>Resource contention is a common problem for Data Engineering teams. Usually, there will be large runs in the morning to calculate the previous day&#x27;s data or reload tables. On warehouses that have flat resources or scaling limits, Pulse queries can be significantly slower during these windows, and additionally will slow down core business logic pipelines.</p>
<p>The best practice is to assign a scoped resource to Statsig&#x27;s service user. This has a few advantages:</p>
<ul>
<li>Costs are easy to understand, since anything billed to that resource is attributable to Statsig</li>
<li>You can control the max spend by controlling the size of the resource, and independently scale the resource as your experimentation velocity increases</li>
<li>Statsig jobs will not effect your production jobs, and vice versa</li>
</ul>
<p>If this is not possible, it&#x27;s a good idea to:</p>
<ul>
<li>Schedule your Statsig runs after your main runs - this also ensures the data in your experiment analysis is fresh</li>
<li>Use API triggers to launch Statsig analyses after the main run is finished</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analytics-optimization">Analytics Optimization<a href="#analytics-optimization" class="hash-link" aria-label="Direct link to Analytics Optimization" title="Direct link to Analytics Optimization">​</a></h2>
<p>When using Statsig’s Metric Explorer to visualize the data within your warehouse, optimizing table layout and clustering configurations can greatly improve latency. This section serves to describe a set of best practices you can employ to improve the performance of analytics queries. Here are recommendations for some of the most commonly used warehouses.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bigquery">BigQuery<a href="#bigquery" class="hash-link" aria-label="Direct link to BigQuery" title="Direct link to BigQuery">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="table-layout---partitioning--clustering">Table Layout - Partitioning &amp; Clustering<a href="#table-layout---partitioning--clustering" class="hash-link" aria-label="Direct link to Table Layout - Partitioning &amp; Clustering" title="Direct link to Table Layout - Partitioning &amp; Clustering">​</a></h4>
<p>We advise partitioning on event date and clustering on event when defining your events table. This will improve performance as the majority of queries will filter for the name of the event and the time it was logged. When defining the partition on event date, you should truncate the timestamp to day-level granularity instead of using the raw timestamp (which would otherwise have millisecond precision resulting in very high cardinality).</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Create an events table partitioned by date and clustered by event.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE dataset.events (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ts TIMESTAMP NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  event STRING NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITION BY DATE(ts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTER BY event;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>BigQuery’s support for applying a cluster to an existing table is limited. Additionally, adding a cluster to an existing table will not automatically recluster the data right away. Given this, if you need to repartition on event date or add a cluster by event, you can create a new table with the correct partitions and clusters using your current table.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Using an existing events table, create a new table that is partitioned by date and clustered by event.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE OR REPLACE TABLE dataset.events_new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITION BY DATE(ts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTER BY event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM dataset.events;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- (Optional) Swap the name of your new table with the old one for consistency.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DROP TABLE dataset.events;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE dataset.events_new RENAME TO events;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="databricks">Databricks<a href="#databricks" class="hash-link" aria-label="Direct link to Databricks" title="Direct link to Databricks">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="preferred-use-liquid-clustering">(Preferred) Use Liquid Clustering<a href="#preferred-use-liquid-clustering" class="hash-link" aria-label="Direct link to (Preferred) Use Liquid Clustering" title="Direct link to (Preferred) Use Liquid Clustering">​</a></h4>
<p>When making clustering decisions in your events table layout, <a href="https://docs.databricks.com/aws/en/delta/clustering" target="_blank" rel="noopener noreferrer">liquid clustering</a> provides a flexible approach that allows you to modify your clustering keys without needing to manually rewrite existing data.</p>
<p>We recommend employing liquid clustering for your events table with the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Enable liquid clustering for your events table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE events SET TBLPROPERTIES (&#x27;delta.liquidClustering.enabled&#x27; = &#x27;true&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Cluster on the event column.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE events ALTER CLUSTER BY (event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Trigger clustering using the OPTIMIZE command.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPTIMIZE events;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If your events table is frequently being updated, Databricks recommends scheduling <code>OPTIMIZE</code> jobs every 1-2 hours. This will incrementally apply liquid clustering to your table.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-partitioning-and-zorder">(Alternative) Partitioning and ZORDER<a href="#alternative-partitioning-and-zorder" class="hash-link" aria-label="Direct link to (Alternative) Partitioning and ZORDER" title="Direct link to (Alternative) Partitioning and ZORDER">​</a></h4>
<p>If you choose not to use liquid partitioning, our recommendation is to partition on a single low cardinality column such as the date of the event. Try to avoid adding more than one column on the partition unless absolutely necessary and don&#x27;t partition on a column that has a cardinality that would exceed one thousand. We suggest using a generated column to simplify pruning:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Define a partition on the event date generated column.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE events (ts TIMESTAMP, event STRING, event_date DATE GENERATED ALWAYS AS (CAST(ts AS DATE))) USING DELTA PARTITIONED BY (event_date);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can use <code>ZORDER</code> to colocate similar values within a file for a high cardinality column, which benefits query performance by improving data skipping. We recommend doing this on the event column:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- ZORDER by the event column to improve data skipping.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPTIMIZE events ZORDER BY (event);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using a scheduled job that runs <code>OPTIMIZE</code> on the last week’s event data, you can improve query performance by compacting the number of small data files into fewer, larger files:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Periodically optimize the events table based on the last week of data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPTIMIZE events WHERE event_date &gt;= current_date() - INTERVAL 7 DAYS;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In general, avoid partitioning on a combination of event date and event. For even small queries, this can create a lot of overhead. Given 500 events, this would cause a 30-day query to hit 15,000 partitions. Instead, partition only by date as described above and <code>ZORDER</code> on the event.</p>
<p>If extra parallelism is desired without introducing too many partitions, you can <code>ZORDER</code> by an additional bucket column. This bucket column can be defined as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Add bucket column for extra parallelism.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE events ADD COLUMN event_bucket INT GENERATED ALWAYS AS (pmod(hash(event), 16));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Rewrite data into new files based on this ZORDER key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPTIMIZE events ZORDER BY (event_bucket);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="partition-pruning">Partition Pruning<a href="#partition-pruning" class="hash-link" aria-label="Direct link to Partition Pruning" title="Direct link to Partition Pruning">​</a></h4>
<p>Dynamic File Pruning will enable Spark to prune partitions based on filter values at runtime. It should be enabled if possible using:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Turn on Dynamic File Pruning.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET spark.databricks.optimizer.dynamicFilePruning = true;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="handling-skew-and-joins">Handling Skew and Joins<a href="#handling-skew-and-joins" class="hash-link" aria-label="Direct link to Handling Skew and Joins" title="Direct link to Handling Skew and Joins">​</a></h4>
<p>To rebalance skew and adjust join strategy, we advise turning on Adaptive Query Execution:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Turn on Adapative Query Execution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET spark.sql.adaptive.enabled = true;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="compute-choices">Compute Choices<a href="#compute-choices" class="hash-link" aria-label="Direct link to Compute Choices" title="Direct link to Compute Choices">​</a></h4>
<p>The Photon query engine allows for faster execution of queries with more efficient use of CPU and memory. If possible, it should be enabled for your compute cluster or SQL warehouse.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="redshift">Redshift<a href="#redshift" class="hash-link" aria-label="Direct link to Redshift" title="Direct link to Redshift">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="table-design---distribution-style-and-sort-key">Table Design - Distribution Style and Sort Key<a href="#table-design---distribution-style-and-sort-key" class="hash-link" aria-label="Direct link to Table Design - Distribution Style and Sort Key" title="Direct link to Table Design - Distribution Style and Sort Key">​</a></h4>
<p>As Redshift does not support partitioning by column, we can instead employ use of a sort key. Given most event tables are generally append-only and time-based, we advise use of a compound sort key on (timestamp, event) so that the data is ordered by time. Given all analytics queries will filter on timestamp, this should allow for queries to read only the relevant blocks.</p>
<p>Ordering secondarily by event will mean rows are grouped by event within each time block, which can reduce scan size when filtering by event. We want pruning to be primarily upon timestamp, which is why it is kept as the first key.</p>
<p>Given there can be significant skew among event types, we generally advise using an automatic distribution style rather than distributing upon the event column. This will allow Redshift to make distribution decisions based on the size of the table and query patterns. You can create an events table with the above recommendations in mind as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Create an events table with an automatic distrbution style and sort key on timestamp, event.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE events (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  event       VARCHAR NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ts          TIMESTAMP     NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISTSTYLE AUTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMPOUND SORTKEY (ts, event);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you already have an events table and want to leverage the recommended distribution style and sort key, you won’t be able to apply those changes by modifying the existing table. Instead, you can create a new table and copy over data:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Create a new events table with the preferred distribution style and sort key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE events_new (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  event       VARCHAR NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ts          TIMESTAMP     NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DISTSTYLE AUTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMPOUND SORTKEY (ts, event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Copy over data from the old events table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO events_new (event, ts, ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT event_id, ts, ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM events;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Rename the two tables in a single transaction.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BEGIN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE events RENAME TO events_old;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE events_new RENAME TO events;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMMIT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Drop the old table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DROP TABLE events_old;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="snowflake">Snowflake<a href="#snowflake" class="hash-link" aria-label="Direct link to Snowflake" title="Direct link to Snowflake">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="clustering-keys">Clustering Keys<a href="#clustering-keys" class="hash-link" aria-label="Direct link to Clustering Keys" title="Direct link to Clustering Keys">​</a></h4>
<p>Given Snowflake does not allow for explicit partitioning, we recommend using clustering keys on the event date and event to improve performance as the majority of queries will filter for the name of the event and the time it was logged. Note that we advise clustering on the timestamp truncated to day-level granularity instead of the raw timestamp (which would otherwise have millisecond precision causing very high cardinality).</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Cluster events on the timestamp truncated to day and event.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE events CLUSTER BY (DATE_TRUNC(&#x27;day&#x27;, ts), event);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you have a high cardinality of unique event types, it might be advisable to add a search optimization on event instead of clustering by that column. See the <a href="#managing-high-cardinality-columns">next section</a> for details.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="managing-high-cardinality-columns">Managing High Cardinality Columns<a href="#managing-high-cardinality-columns" class="hash-link" aria-label="Direct link to Managing High Cardinality Columns" title="Direct link to Managing High Cardinality Columns">​</a></h4>
<p>If there are high cardinality columns that you frequently reference in Metrics Explorer filters, consider using search optimization rather than clustering by it. This avoids an overly large range of values for each micro-partition generated by Snowflake, which would make pruning inefficient. For high cardinality columns, we can instead rely on the auxiliary search index generated through search optimization.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Add search optimization for fast lookups.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE events ADD SEARCH OPTIMIZATION ON EQUALITY(some_column);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="monitoring-clustering">Monitoring Clustering<a href="#monitoring-clustering" class="hash-link" aria-label="Direct link to Monitoring Clustering" title="Direct link to Monitoring Clustering">​</a></h4>
<p>You can use <code>SYSTEM$CLUSTERING_INFORMATION</code> to check if your current clustering scheme is effective. Large values of average_depth and average_overlaps may indicate the existing table should be reclustered on different keys with lower cardinality.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Given an events table clustered on event date and event, check the clustering information.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT SYSTEM$CLUSTERING_INFORMATION(&#x27;YOUR_DATABASE.YOUR_SCHEMA.EVENTS&#x27;, &#x27;(DATE_TRUNC(&#x27;&#x27;day&#x27;&#x27;, ts), event)&#x27;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="timestamp-column">Timestamp Column<a href="#timestamp-column" class="hash-link" aria-label="Direct link to Timestamp Column" title="Direct link to Timestamp Column">​</a></h4>
<p>If possible, use the <code>TIMESTAMP_NTZ</code> (no timezone) type for your timestamp column. This saves on space as the offset metadata will not need to be stored. It additionally can help speed up queries as it allows Snowflake to avoid the extra work for timezone normalization internally, which would otherwise take place during filtering and pruning of micro-partitions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="questions">Questions?<a href="#questions" class="hash-link" aria-label="Direct link to Questions?" title="Direct link to Questions?">​</a></h3>
<p>If you need additional support in optimizing your warehouse configuration for analytics, please reach out in the Slack support channel for your organization within Statsig Connect.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugging">Debugging<a href="#debugging" class="hash-link" aria-label="Direct link to Debugging" title="Direct link to Debugging">​</a></h2>
<p>Statsig shows you all the SQL being run, and any errors that occur. Generally these are caused by changing underlying tables or Metric Sources, causing a metric query to fail. Here&#x27;s some best practices for debugging Statsig Queries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-the-queries-from-your-statsig-console">Use the Queries from your Statsig console<a href="#use-the-queries-from-your-statsig-console" class="hash-link" aria-label="Direct link to Use the Queries from your Statsig console" title="Direct link to Use the Queries from your Statsig console">​</a></h3>
<p>If a pulse load fails, you can find all of the SQL queries and associated error messages in the Diagnostics tab. You can easily click the copy button to run/debug the query within your warehouse. Look out for common errors:</p>
<ul>
<li>A query attempting to access a field that no longer exists on a table</li>
<li>A table not existing - usually due to the Statsig user not having permission on a new table</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="turbo-mode">Turbo Mode<a href="#turbo-mode" class="hash-link" aria-label="Direct link to Turbo Mode" title="Direct link to Turbo Mode">​</a></h2>
<p><a href="/statsig-warehouse-native/features/turbo">Turbo Mode</a> skips some enrichment calculations (in particular some time series rollups) in order to very cheaply compute the latest snapshot of your data. With this, customers have run experiments on 150+ million users in less than 5 minutes on a snowflake S cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ask">Ask!<a href="#ask" class="hash-link" aria-label="Direct link to Ask!" title="Direct link to Ask!">​</a></h3>
<p>Statsig&#x27;s support is very responsive, and will be happy to help you fix your issue and build tools to prevent it in the future - whether it&#x27;s due to system or user error.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="compute-cost-transparency">Compute Cost Transparency<a href="#compute-cost-transparency" class="hash-link" aria-label="Direct link to Compute Cost Transparency" title="Direct link to Compute Cost Transparency">​</a></h2>
<p>Statsig Warehouse Native now lets you get a birds eye view across the compute time experiment analysis incurs in your warehouse. Break this down by experiment, metric source or type of query to find what to optimize.
Common customers we&#x27;ve designed the dashboard to be able to address include
What Metric Sources take the most compute time (useful to focus optimization effort here; see tips here)
What is the split of compute time between full loads vs incremental loads vs custom queries?
How is compute time distributed across experiments? (useful to make sure value realized and compute costs incurred are roughly aligned)</p>
<p>You can find this dashboard in the Left Nav under Analytics -&gt; Dashboards -&gt; Pipeline Overview
<img decoding="async" loading="lazy" src="https://github.com/user-attachments/assets/684ae633-8054-4f41-8443-7df63fe81253" alt="Pipeline Overview dashboard interface" class="img_ev3q"></p>
<p>This is built using Statsig Product Analytics - you can customize any of these charts, or build new ones yourself. A favorite is to add in your average compute cost, so you can turn slot time per experiment into $ cost per experiment.</p>
<p>At the end of every Pulse load / DAG, we&#x27;ll upload a single row to the <code>pipeline_overview</code> table for each job executed as part of that run. This table has the following schema:</p>
<table><thead><tr><th>Column</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>ts</td><td>timestamp</td><td>Timestamp at which the DAG was created.</td></tr><tr><td>job_type</td><td>string</td><td>Job type (see <a href="https://docs.statsig.com/statsig-warehouse-native/pipeline-overview/" target="_blank" rel="noopener noreferrer">Pipeline Overview</a>)</td></tr><tr><td>metric_source_id</td><td>string</td><td>Only applicable for &#x27;Unit-Day Calculations&#x27; jobs - the ID of the metric source</td></tr><tr><td>assignment_source_id</td><td>string</td><td>The Assignment Source ID of the experiment for which Pulse was loaded.</td></tr><tr><td>job_status</td><td>string</td><td>The final state of the job (<code>fail</code> or <code>success</code>)</td></tr><tr><td>metrics</td><td>string</td><td>Metrics processed by the job</td></tr><tr><td>dag_state</td><td>string</td><td>Final state of the DAG (<code>success</code>, <code>partial_failure</code>, or <code>failure</code>)</td></tr><tr><td>dag_type</td><td>string</td><td>Type of DAG (<code>full</code>, <code>incremental</code>, <code>metric</code>, <code>power</code>, <code>custom_query</code>, <code>autotune</code>, <code>assignment_source</code>, <code>stratified_sampling</code>)</td></tr><tr><td>experiment_id</td><td>string</td><td>ID of the experiment for which Pulse was loaded, if applicable</td></tr><tr><td>dag_start_ds</td><td>string</td><td>Start of the date range being loaded</td></tr><tr><td>dag_end_ds</td><td>string</td><td>End of the date range being loaded</td></tr><tr><td>wall_time</td><td>number</td><td>Total time elapsed between DAG start and finish, in milliseconds</td></tr><tr><td>turbo_mode</td><td>boolean</td><td>Whether the DAG was run in Turbo Mode</td></tr><tr><td>dag_id</td><td>string</td><td>Internal identifier for the DAG</td></tr><tr><td>dag_duration</td><td>number</td><td>Number of days in the date range being loaded</td></tr><tr><td>is_scheduled</td><td>boolean</td><td>Whether the DAG was triggered by a scheduled run</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/statsig-io/docs/edit/main/docs/statsig-warehouse-native/guides/best-practices.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-24T00:00:00.000Z" itemprop="dateModified">Sep 24, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/statsig-warehouse-native/guides/costs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Warehouse Costs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/statsig-warehouse-native/configuration/data-and-semantic-layer"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cost-management" class="table-of-contents__link toc-highlight">Cost Management</a><ul><li><a href="#follow-sql-best-practices" class="table-of-contents__link toc-highlight">Follow SQL Best Practices</a></li><li><a href="#materialize-tablesviews" class="table-of-contents__link toc-highlight">Materialize Tables/Views</a></li><li><a href="#use-incremental-reloads" class="table-of-contents__link toc-highlight">Use Incremental Reloads</a></li><li><a href="#reload-data-ad-hoc" class="table-of-contents__link toc-highlight">Reload Data Ad-Hoc</a></li><li><a href="#leverage-statsigs-advanced-options" class="table-of-contents__link toc-highlight">Leverage Statsig&#39;s Advanced Options</a></li><li><a href="#utilize-metric-level-reloads" class="table-of-contents__link toc-highlight">Utilize Metric Level Reloads</a></li><li><a href="#use-statsigs-macros" class="table-of-contents__link toc-highlight">Use Statsig&#39;s Macros</a></li><li><a href="#avoid-contention" class="table-of-contents__link toc-highlight">Avoid Contention</a></li></ul></li><li><a href="#analytics-optimization" class="table-of-contents__link toc-highlight">Analytics Optimization</a><ul><li><a href="#bigquery" class="table-of-contents__link toc-highlight">BigQuery</a></li><li><a href="#databricks" class="table-of-contents__link toc-highlight">Databricks</a></li><li><a href="#redshift" class="table-of-contents__link toc-highlight">Redshift</a></li><li><a href="#snowflake" class="table-of-contents__link toc-highlight">Snowflake</a></li><li><a href="#questions" class="table-of-contents__link toc-highlight">Questions?</a></li></ul></li><li><a href="#debugging" class="table-of-contents__link toc-highlight">Debugging</a><ul><li><a href="#use-the-queries-from-your-statsig-console" class="table-of-contents__link toc-highlight">Use the Queries from your Statsig console</a></li></ul></li><li><a href="#turbo-mode" class="table-of-contents__link toc-highlight">Turbo Mode</a><ul><li><a href="#ask" class="table-of-contents__link toc-highlight">Ask!</a></li></ul></li><li><a href="#compute-cost-transparency" class="table-of-contents__link toc-highlight">Compute Cost Transparency</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/faq">FAQ</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://statsig.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Statsig Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://statsig.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://statsig.com/slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/statsig-io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://learn.statsig.com/certifications" target="_blank" rel="noopener noreferrer" class="footer__link-item">Statsig University<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright (c) 2025 Statsig, Inc. | Thanks Docusaurus</div></div></div></footer></div>
</body>
</html>